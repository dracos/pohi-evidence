FUJ00001904

FUJ00001904
Horizon - LINK Mapping _ Project: EMV - Banking and Retail
COMMERCIAL IN CONFIDENCE _—D0e Ref: NB/IFS/033
. .
EMV — Banking and Retail
Horizon - LINK Mapping
RoLe Name AREA OF I SIGNATURE Date
RESPONSIBILITY
Authors Phil Turner on behalf I Business
of Post Office Ltd Architecture
Product
Deployment
FS RASD Tony Drahota Technical
Director Architecture
DA Sign-off David Gray Design
(Peer Reviewer) Authority
Programme Beverley Dunn Project
Director Delivery
Created on 04/11/2004 Version 1.0 Page 1 of 10

© Post Office™ 2004
FUJ00001904

FUJ00001904
Horizon - LINK Mapping Project: EMV — Banking and Retail
COMMERCIAL IN CONFIDENCE _—D0e Ref: NB/IFS/033
1 Document Control
1.1 Document Information
Horizon Release No: $75
Document Title: EMV Banking and Retail — Horizon - LINK Mapping
Document Type: Application Interface Specification
Abstract: This document details the mapping of messages between Horizon and
LINK.
Document Status: Approved
Originator & David Gray
Department: Design Authority
Contributors:
Post Office Design Authority - David Gray
Distribution: POL Document Control — Post Office Programme Office
Supplier Distribution: I LINK — Geoff Barker
Fujitsu Services: Gill Jackson
Client Distribution: N/A
Table 1: Document Information
1.2 Document History
Version I Date Reason for Issue Associated
WP /CT
0.1 28 May 2004 First working draft. Based on document supplied by IBM,
“Network Banking Engine Horizon - LINK Mapping",
but changed to map the messages processed by NBX,
and to include ICC fields.
0.2 07 Jul 2004 Minor corrections and changed to the form of a Post
Office document.
0.3 21 Oct 2004 ~— Corrections resulting from review.
0.4 29 Oct 2004 Minor amendments resulting from AIS and business
parameter changes.
1.0 4 Nov 2004 Minor clarification and issued for Approval
Table 2: Document History
1.3 Change Process
Any changes to this issued version of this document will be made, controlled and distributed by: -
Created on 04/11/2004 Version 1.0 Page 2 of 10

© Post Office™ 2004
FU,

Horizon - LINK Mapping Project: EMV - Banking and Retail
COMMERCIAL IN CONFIDENCE _—D0e Ref: NB/IFS/033

FUJ00001904
jJ00001904

Tony.W.Stevens@Postoffice.co.uk

1.4 Review Details

Review

Comments by :

Review

Comments to :

Mandatory Review Authority Name

Post Office Ltd Beverley Dunn, David Gray, Post Office Ltd
Fujitsu Services Ltd Tony Drahota

LINK Michael Abendstern

Optional Review / Issued for Information

Post Office Ltd Bob Booth, Paul Warbrick, Jason Crellin
LINK
Fujitsu Services Ltd Chris Bailey, Peter Lucas, Rex Dixon, Tom

Northcott, Steve Probert, Richard Hicks,
David Johns, Simon Fawkes, Mark Jarosz,
Janusz Holender, Nasser Siddiqi, Steve
Newman, Anne Mohan, John Rayner

1.5 Changes in this Version

Version I Changes

0.1 N/A. This is the first version.

0.2 Re-issued as a Post Office document.

In [R3]: Third digit of Point of Service Entry Mode and subfield 8 of Point of Service Data
made a configurable mapping of [R1] Txn_Type. Application PAN Sequence Number
mapped from ICC tag 5F34, and not mandatory for non-ICC transactions.

In [A3]: Removal of Bank_Transaction_Id and Settlement_Date from [A3] generated
when there is no [A‘1]. Point of Service Data

Clarifcations and correction of typing errors.

0.3 Response code 90 added. Use of "Fee" field in [A3] clarified. Use of Start_Date (as input
to [R1] fields 23 and 123) clarified. Distribution list corrected. Corrected first character of
field 60 in [E1] for ICC. Various typing errors fixed as per comments.

The spreadsheet columns containing historical information about NBE have been
hidden.

0.4 Mapping for subfield 2 of field 61 adjusted to align with change to AIS.

Clarified that, regardless of transaction type, NBX does not return balances to the
counter if the response code for the transaction was neither 00 (authorised) nor 51
(insufficient funds), even if balances have been received from the Fl.

Created on 04/11/2004 Version 1.0 Page 3 of 10

© Post Office™ 2004
FUJ00001904
FUJ00001904

Horizon - LINK Mapping Project: EMV — Banking and Retail

COMMERCIAL IN CONFIDENCE _—D0e Ref: NB/IFS/033

Specified Reversal Reason Code mapping for the case where the card declines a
transaction after it has been authorised by the FI.

1.0 Clarified that in the case of transactions whose details are entered manually, the
presence of an Application PAN Sequence Number (field 023) in a request depends on
whether reference data is configured to cause the card issue number to be entered.

1.6 Key Contacts

Table 3: Changes in this Version

Name I Position

Bob Booth Solutions Architect
Michael Abendstern Technical Specialist
Phil Turner Design Architect

Phone Number

GRO I

Table 4: Key Contacts

1.7 Associated Documents

Reference Version I Date Title Source
LISS 2004-1 LINK Switch Service Interchange. LINK
Vsn 1.1 Standard (LISS)
NB/IFS/0024 NBX-LINK Application Interface Post Office
Specification (AIS)
1.2 LISS — Deposits “What's New” LINK
NB/IFS/004 Network Banking Message Flows and Fujitsu
Interfaces Services

Table 5: Associated Documents

Unless a specific version is referred to above, reference should be made to the current approved versions

of the documents.

1.8 Abbreviations/Definitions

Abbreviation

Definition

Authorisation Agent

The part of the NBX which interfaces to Fls and carries out the

message mapping.

BCD Binary Coded Decimal

FI Financial Institution

NBE Network Banking Engine

NBX The term used to describe the NBE functionality absorbed into the

Created on 04/11/2004
© Post Office™ 2004

Version 1.0

Page 4 of 10
FUJ00001904
FUJ00001904

“ Horizon - LINK Mapping Project: EMV - Banking and Retail
COMMERCIAL IN CONFIDENCE —_—Doc Ref: NB/IFS/033

Horizon domain.

Table 6: Abbreviations/Definitions

In addition, the message names [A‘], [R3], [E1], [E2] and the abbreviations for their field formats are used as
in ref [2], while the names and field format abbreviations for the messages [R1], [A3], [CO] are as in ref [4].

Created on 04/11/2004 Version 1.0 Page 5 of 10
© Post Office™ 2004
FUJ00001904

FUJ00001904

Horizon - LINK Mapping Project: EMV — Banking and Retail

COMMERCIAL IN CONFIDENCE _—D0e Ref: NB/IFS/033
Table of Contents
1 DOCUMENT CONTROL 2
1.1. Document Information 2
1.2. Document History 2
1.3. Change Process 2
1.4 Review Details 3
1.5. Changes in this Version 3
1.6 Key Contacts 4
1.7 Associated Documents 4
1.8 Abbreviations/Definitions 4
2 INTRODUCTION 7
2.1. Scope 7
2.2 Structure 7
3 NOTES ON THE SPREADSHEET 8
4 MESSAGE MAPPING SPREADSHEET 10
Created on 04/11/2004 Version 1.0 Page 6 of 10

© Post Office™ 2004
FUJ00001904
FUJ00001904

Horizon - LINK Mapping Project: EMV - Banking and Retail
COMMERCIAL IN CONFIDENCE _—D0e Ref: NB/IFS/033

2 Introduction

This document identifies the data mapping between the various message elements of the message sets where
NBX acts as the conduit between Horizon and LINK. It should be used in conjunction with the AIS (Ref [2]).
Any translations that need to be performed to convert from one particular message format to another are
identified, together with how the translation is achieved, where possible. In addition, the data that is required
by a message, but which is not present in the source message from another message set, is identified together
with an alternative source.

The following sources can be used to populate a message:

Transaction messages Data is mapped from a message element in one message to a
corresponding message element in another, possibly undergoing
translation.

Configuration The exact locations of configuration data will be specified in the design

documentation, but the essential property of values that are stated to be
configurable is that they can accommodate rapid amendment or
extension as required. Note that where a field is common to a number of
messages, configurable mappings are based on configuration data that is
also common to all the messages. So the mapping of such common
fields can be configured only once and applies to all LINK messages, it is
not configured individually on a per-message basis.

System Date The date as held on the NBX Authorisation Agent system.
System Time The time as held on the NBX Authorisation Agent system.
Fixed Value Data that always has a fixed value
2.1 Scope
The document considers the following message mappings:
Balance Enquiry [R1] to [R3] 0100
Withdrawal [R14] to [R3] 0200
Deposit [R14] to [R3] 0200
Balance Enquiry Response [A1] 0110 (or [R1]) to [A3]
Withdrawal Response [A1] 0210 (or [R1]) to [A3]
Deposit Response [A1] 0210 (or [R1]) to [A3]
Reversal Request [R3],[A1] and possibly [CO] to [E1] 0420/0421

Response Codes
Reversal Reason Codes

Reversal Request Response [E2] messages received from LINK are only used internally within the NBX (i.e.
they are not mapped to a Horizon message), and so are not within the scope of this document.

2.2 Structure

The message mappings are contained in an Excel spreadsheet, which has been embedded in this document.
To open the spreadsheet, double-click on the attachment icon. The first sheet contains a summary of the
message mappings that are included in the scope of this document. Subsequent sheets detail each of the
mappings in turn.

Created on 04/11/2004 Version 1.0 Page 7 of 10
© Post Office™ 2004
FUJ00001904
FUJ00001904

Horizon - LINK Mapping Project: EMV - Banking and Retail
COMMERCIAL IN CONFIDENCE _—D0e Ref: NB/IFS/033

3 Notes on the Spreadsheet

For each message pair, the triggered message is shown on the left, with the triggering (or source) message on
the right. The exception to this is the “Reversal Request” [E1] message, which can be triggered either by a
[CO] message, or by a late [A1] Approve response from LINK, and is populated from a number of other
messages. In this case the right of the sheet contains elements from each of these messages, and an
additional column has been included to indicate which message the element comes from.

The “Source” column contains the details of how the message element in the triggered message is populated,
including the mapping between message elements in each of the messages where applicable. The “Source”
column also includes a description of any translations that need to take place in the NBX.

A greyed out row in the triggering message indicates that there is a field in the triggered message that is not
populated from data contained in that source message. In these cases, the triggered message field may be
populated from a different message, determined by the NBX or taken from Reference Data. Fields that have
been identified as being not required in the NBX — LINK Application Interface Specification document,
Reference [2], have not been included in the message.

A greyed out row in the triggered message column indicates that there is a field in the triggering message that
has no corresponding field in the triggered message.

For example, fields provided in a LINK message that do not map onto a Horizon field, are not passed on by
the NBX, but are logged.

Similarly there are fields provided in a Horizon message that do not map onto a LINK field, and are not passed
on. The full list of fields in Horizon messages and their definitions and uses can be found in [4]; the following
fields which are not directly mapped to LINK messages are nevertheless relevant to NBX for the following
purposes:

Clerk_Identity Records identity of clerk operating at the outlet workstation (also
known as node or counter). This is required for audit purposes.

Client_Id Identifies a client of POL that is the end bank (card issuer) for a
transaction. This element is needed for reconciliation and
reports.

Digital Signature Used in conjunction with Signature_Type to check that the
message is valid.

Issuer_Scheme_Id A code to identify the Issuer Scheme, set from Reference Data at
the counter.

Message_Type Classifies the type of message being sent. e.g. R1 or CO.

Routing_Gateway Use to route transactions to the correct logical PI

Signature_Type Used in conjunction with Digital Signature to check that the

message is valid.

Transactions are uniquely identified in the system by a combination of the Riposte Group ID and Node ID of
the originating counter, together with the receipt transaction date (year and day), and the last 6 digits of the
message number component of the Horizon_Txn_Num field of the message which originated the transaction.
In messages to LINK this information is held in the form of the Terminal Identification (which is made up from
the Riposte Group ID and Node ID) and the Retrieval Reference Number (which includes the receipt
transaction date and message number information).

The following point should be noted with regard to the use of binary coded decimal fields in ICC data: in
communication with the counter this data is transferred using one character for each decimal digit, but if there
is an odd number of digits, an extra padding character, a zero, is included at the start of the number. It follows,
for example, that a field shown in the spreadsheet as having 3 BCD digits would actually be transmitted as 4
characters, the first being a zero used for padding. This encoding facilitates the counter's communications with
the Pin Pad. The spreadsheet indicates in such cases whether or not the padding is retained when mapping
the messages.

Created on 04/11/2004 Version 1.0 Page 8 of 10
© Post Office™ 2004
FUJ00001904
FUJ00001904

Horizon - LINK Mapping Project: EMV - Banking and Retail
COMMERCIAL IN CONFIDENCE _—D0e Ref: NB/IFS/033

(The spreadsheet also contains some historical information about the mappings performed by the original NBE
system, but the rows and columns containing this information are hidden and so are not seen when looking at
the spreadsheet. They do not need to be considered with regard to the NBX system.)

Created on 04/11/2004 Version 1.0 Page 9 of 10
© Post Office™ 2004
FUJ00001904

FUJ00001904

Horizon - LINK Mapping Project: EMV - Banking and Retail
COMMERCIAL IN CONFIDENCE _—D0e Ref: NB/IFS/033

4 Message Mapping Spreadsheet

“Horizon - LINK
Mapping.xls"
END OF DOCUMENT
Created on 04/11/2004 Version 1.0 Page 10 of 10

© Post Office™ 2004
