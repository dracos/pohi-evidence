FUJ00002068

FUJ00002068
Horizon - Card Account Project: EMV - Banking and Retail
Mappi
‘apping Doc Ret: NB/IFS/031
COMMERCIAL IN CONFIDENCE
. .
EMV — Banking and Retail
Horizon - Card Account Mapping

Role NAME AREA OF I SIGNATURE Date

RESPONSIBILITY
Authors Chris Bailey on behalf I Business

of Post Office Ltd Architecture

Product

Deployment
FS Dave Johns Technical
Architecture Architecture
DA Sign-off Richard Cowan Design
(Peer Reviewer) Authority
Project James Keenan Project
Manager Delivery

Created on 30/06/2008 Version 2.0 Page 1 of 10

© Post Office™ 2004
Horizon - Card Account Project:

Mapping Doc Ref: NB/IFS/031

COMMERCIAL IN CONFIDENCE

FUJ00002068
FUJ00002068

EMV - Banking and Retail

1 Document Control

1.1 Document Information

Horizon Release No:

T86

Document Title:

EMV Banking and Retail — Horizon - Card Account Mapping

Document Type:

Application Interface Specification

Abstract:

This document details the mapping of messages between Horizon and

Card Account

Document Status:

Approved

Originator &
Department:

Richard Cowan
Design Authority

Contributors:

Post Office
Distribution:

Design Authority — Richard Cowan
POL Document Control — Post Office Programme Office

Supplier Distribution:

EDS: Mark Geldart
Fujitsu Services: John Burton

Client Distribution:

N/A

Table 1: Document Information

1.2 Document History

Version I Date Reason for Issue Associated
WP /CT
0.1 15 March First working draft. Based on document supplied by IBM,
2004 ref [3], but changed to map the messages processed by
NBX, and to include ICC fields.
0.2 1 April 2004 I Updated as a result of comments
0.3 16 April 2004 I Minor corrections
0.4 28 May 2004 Further minor corrections and issued for review within
Fujitsu Services
0.5 19 Oct 2004 ~~ Updated as a result of comments and changed to the
form of a Post Office document.
1.0 05 Nov 2004 Incorporation of review comments and _ minor
Clarifications. Issued for approval.
1.1 19 May 2008 Addition of new message variants and new responses to I Tbs
the embedded spreadsheet to reflect changes required by
Withdrawal Corrections
1.2 29 May 2008 Amended to reflect use of Chip and PIN as per
Created on 30/06/2008 Version 2.0 Page 2 of 10

© Post Office™ 2004
FUJ00002068

FUJ00002068
Horizon - Card Account Project: EMV - Banking and Retail
Mapping Doc Ref: NB/IFS/031
COMMERCIAL IN CONFIDENCE
requirements of CAPO card.
1.3 9 Jun 2008 Amended Approvers and Reviewers in light of comments
1.4 13 Jun 208 Correction to spreadsheet. Amended fields are
highlighted in yellow.
2.0 30 Jun 2008 Issued for Approval
Minor corrections in spreadsheet — highlighted in yellow
Table 2: Document History
1.3 Change Process
Any changes to this issued version of this document will be made, controlled and distributed by: -
Richard Cowan via Post Office Document Management
[IT.Controlled. Document.Review@PostOffice.co.uk]
1.4 Review Details
Review
Comments by :
Review Chris Bailey, Fujitsu Services
Comments to :
Mandatory Review Authority Name
Post Office Ltd James Keenan, Richard Cowan
JPMorgan Europe Limited Mary McMichael
EDS Mark Geldart
Fujitsu Services Ltd
Horizon Programme Manager John Burton
Optional Review / Issued for Information
Post Office Ltd Bob Booth, Richard Cowan, Tim Batterbee
JPMorgan Europe Limited Derek Smallworth
EDS Keith Peers
Fujitsu Services Ltd
Design Authority David Johns
Design Gareth Jenkins, Andy Williams
Test Design Peter Robinson
1.5 Changes in this Version
Version I Changes
2.0 Minor corrections:
Created on 30/06/2008 Version 2.0 Page 3 of 10

© Post Office™ 2004
FUJ00002068

FUJ00002068

Horizon - Card Account Project: EMV - Banking and Retail

Mapping Doc Ref: NB/IFS/031
COMMERCIAL IN CONFIDENCE

Corrected reference to amount requested in withdrawal correction to not refer to
withdraw limit

Amended conditions under which a balance will be returned on deposit correction to
include list errors and remove reference to insufficient funds

Table 3: Changes in this Version

1.6 Key Contacts

Name

Position Phone Number

Bob Booth

Solutions Architect

Table 4: Key Contacts

1.7 Associated Documents

I Reference I Version I Date Title Source
1SO8583:1987(E) Aug 1987 I Bank Card Originated Messages Iso
NB/IFS/025 NBX-CAPO Application Interface Post Office
Specification (AIS)
2.0 Jan 2003 I Network Banking Engine Horizon - I Post Office
POCA Mapping
NB/IFS/004 Network Banking Message Flows. Fujitsu
and Interfaces Services

Table 5: Associated Documents

Unless a specific version is referred to above, reference should be made to the current approved versions

of the documents.

1.8 Abbreviations/Definitions

Abbreviation

Definition

Als

Application Interface Specification

Authorisation Agent

The part of the NBX which interfaces to Fls and carries out the
message mapping.

BCD Binary Coded Decimal

CAPO Card Account Post Office

FI Financial Institution

NBE Network Banking Engine

NBX The term used to describe the NBE functionality absorbed into the

Horizon domain.

Created on 30/06/2008
© Post Office™ 2004

Version 2.0 Page 4 of 10
FUJ00002068
FUJ00002068

“ Horizon - Card Account Project: EMV - Banking and Retail
Mapping Doc Ref: NB/IFS/031

COMMERCIAL IN CONFIDENCE

POCA Post Office Card Account

Table 6: Abbreviations/Definitions

In addition, the message names [A1], [R3], [E1], [E2] and the abbreviations for their field formats are used as
in ref [2], while the names and field format abbreviations for the messages [R1], [A3], [CO] are as in ref [4]

Created on 30/06/2008 Version 2.0 Page 5 of 10
© Post Office™ 2004
FUJ00002068

FUJ00002068
Horizon - Card Account EMV ~ Banking and Retail
Mapping
COMMERCIAL IN CONFIDENCE

Table of Contents

1 DOCUMENT CONTROL 2
1.1. Document Information 2
1.2. Document History 2
1.3. Change Process 3
1.4 Review Details 3
1.5. Changes in this Version 3
1.6 Key Contacts 3
1.7 Associated Documents 3
1.8 Abbreviations/Definitions 3
2 INTRODUCTION 3
2.1. Scope 3
2.2 Structure 3
3 NOTES ON THE SPREADSHEET 3
4 MESSAGE MAPPING SPREADSHEET 3

Created on 30/06/2008 Version 2.0 Page 6 of 10

© Post Office™ 2004
FUJ00002068
FUJ00002068

Horizon - Card Account Project: EMV ~ Banking and Retail
Mapping Doc Ref: NB/IFS/031

COMMERCIAL IN CONFIDENCE

2 Introduction

This document identifies the data mapping between the various message elements of the message sets where
NBX acts as the conduit between Horizon and POCA. It should be used in conjunction with the AIS (Ref [2]).
Any translations that need to be performed to convert from one particular message format to another are
identified, together with how the translation is achieved, where possible. In addition, the data that is required
by a message, but which is not present in the source message from another message set, is identified together
with an alternative source.

The following sources can be used to populate a message:

Transaction messages Data is mapped from a message element in one message to a
corresponding message element in another, possibly undergoing
translation.

Configuration The exact locations of configuration data will be specified in the design

documentation, but the essential property of values that are stated to be
configurable is that they can accommodate rapid amendment or
extension as required. Note that where a field is common to a number of
messages, configurable mappings are based on configuration data that is
also common to all the messages. So the mapping of such common
fields can be configured only once and applies to all POCA messages, it
is not configured individually on a per-message basis.

System Date The date as held on the NBX Authorisation Agent system.
System Time The time as held on the NBX Authorisation Agent system.
Fixed Value Data that always has a fixed value

2.1 Scope

The document considers the following message mappings:

Balance Enquiry [R1] to [R3] 0100

Financial Transaction [R1] to [R3] 0200

Pin Change [R1] to [R3] 0100

Balance Enquiry Response [A1] 0110 (or [R1]) to [A3]

Financial Transaction Response [A1] 0210 (or [R1]) to [A3]

Pin Change Response [A1] 0110 (or [R1]) to [A3]

Reversal Request [R3],[A1] and possibly [CO] to [E1] 0420/0421

Response Code Mapping
Reversal Reason Code Mapping

Reversal Request Response [E2] messages received from POCA are only used internally within the NBX (i.e.
they are not mapped to a Horizon message), and so are not within the scope of this document.

2.2 Structure

The message mappings are contained in an Excel spreadsheet, which has been embedded in this document.
To open the spreadsheet, double-click on the attachment icon. The first sheet contains a summary of the
message mappings that are included in the scope of this document. Subsequent sheets detail each of the
mappings in turn.

Created on 30/06/2008 Version 2.0 Page 7 of 10
© Post Office™ 2004
FUJ00002068
FUJ00002068

Horizon - Card Account Project: EMV ~ Banking and Retail
Mapping Doc Ref: NB/IFS/031

COMMERCIAL IN CONFIDENCE

3 Notes on the Spreadsheet

For each message pair, the triggered message is shown on the left, with the triggering (or source) message on
the right. The exception to this is the “Reversal Request” [E1] message, which can be triggered either by a
[CO] message, or by a late [A1] Approve response from POCA, and is populated from a number of other
messages. In this case the right of the sheet contains elements from each of these messages, and an
additional column has been included to indicate which message the element comes from.

The “Source” column contains the details of how the message element in the triggered message is populated,
including the mapping between message elements in each of the messages where applicable. The “Source”
column also includes a description of any translations that need to take place in the NBX.

A greyed out row in the triggering message indicates that there is a field in the triggered message that is not
populated from data contained in that source message. In these cases, the triggered message field may be
populated from a different message, determined by the NBX or taken from Reference Data. Fields that have
been identified as being not required in the NBX — POCA Application Interface Specification document,
Reference [2], have not been included in the message.

A greyed out row in the triggered message column indicates that there is a field in the triggering message that
has no corresponding field in the triggered message.

For example, fields provided in a POCA message that do not map onto a Horizon field, are not passed on by
the NBX, but are logged.

Similarly there are fields provided in a Horizon message that do not map onto a POCA field, and are not
passed on. The full list of fields in Horizon messages and their definitions and uses can be found in [4]; the
following fields which are not directly mapped to POCA messages are nevertheless relevant to NBX for the
following purposes:

Clerk_Identity Records identity of clerk operating at the outlet workstation (also
known as node or counter). This is required for audit purposes.

Client_Id Identifies a client of POL that is the end bank (card issuer) for a
transaction. This element is needed for reconciliation and
reports.

Digital Signature Used in conjunction with Signature_Type to check that the
message is valid.

Issuer_Scheme_Id A code to identify the Issuer Scheme, set from Reference Data at
the counter.

Message_Type Classifies the type of message being sent. e.g. R1 or CO.

Routing_Gateway Use to route transactions to the correct logical PI

Signature_Type Used in conjunction with Digital Signature to check that the

message is valid.

Transactions are uniquely identified in the system by a combination of the Riposte Group ID and Node ID of
the originating counter, together with the receipt transaction date (year and day), and the last 6 digits of the
message number component of the Horizon_Txn_Num field of the message which originated the transaction.
In messages to POCA this information is held in the form of the Terminal Identification (which is made up from
the Riposte Group ID and Node ID) and the Retrieval Reference Number (which includes the receipt
transaction date and message number information).

The following point should be noted with regard to the use of binary coded decimal fields in ICC data: in
communication with the counter this data is transferred using one character for each decimal digit, but if there
is an odd number of digits, an extra padding character, a zero, is included at the start of the number. It follows,
for example, that a field shown in the spreadsheet as having 3 BCD digits would actually be transmitted from
or to the counter as 4 characters, the first being a zero used for padding. This encoding facilitates the counter's

Created on 30/06/2008 Version 2.0 Page 8 of 10
© Post Office™ 2004
FUJ00002068
FUJ00002068

. Horizon - Card Account Project: EMV - Banking and Retail
Manon
apping Doc Ref: NB/IFS/031

COMMERCIAL IN CONFIDENCE

communications with the Pin Pad. The spreadsheet indicates in such cases whether or not the padding is
retained when mapping the messages for POCA.

(The spreadsheet also contains some historical information about the mappings performed by the original NBE
system, but the rows and columns containing this information are hidden and so are not seen when looking at
the spreadsheet. They do not need to be considered with regard to the NBX system.)

Created on 30/06/2008 Version 2.0 Page 9 of 10
© Post Office™ 2004
FUJ00002068

FUJ00002068

Horizon - Card Account Project: EMV — Banking and Retail
Mapping Doc Ref: NB/IFS/031

COMMERCIAL IN CONFIDENCE

4 Message Mapping Spreadsheet

i)
stil
Horizon - Card
Account Mapping. xIs
END OF DOCUMENT
Created on 30/06/2008 Version 2.0 Page 10 of 10

© Post Office™ 2004
