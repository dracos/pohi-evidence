FUJITSU

FUJITSU SERVICES

S80 Impact Release 3 EPOSS Counter Operational

Support Guide
COMPANY-in-CONFIDENCE

Ref:
Version:
Date:

FUJ00091192
FUJ00091192

EP/SPG/001
1.0
20/05/2005

Document Title:
Document Type:
Release:

Abstract:
Document Status:
Originator & Dept:
Contributors:

Internal Distribution:

External Distribution:

Approval Authorities:

S80 Impact Release 3 EPOSS Counter Operational Support

Guide
SPG

S80

This is the Operational Support Guide for the S80 EPOSS

Counter.

APPROVED

Jon Hulme, APDU Counter Development

S80 Impact Release 3 Counter Development Team

Name Role

Signature

Date

Mik Peach

Operations & Support
Service Manager

Mark Scardifield

Development Manager

©Copyright Fujitsu Services Ltd 2005

COMPANY-in-CONFIDENCE

Page:

10f92
FUJ00091192
FUJ00091192

rT $80 Im i Ref: EP/SPG/001
pact Release 3 EPOSS Counter Operational
FUJITSU Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005
Document Control
0.1 Document History
VersionNo. =I Date’ Reason for Issue I Associated
i: I CP/PEAK/PPRR I
: i a ae a ‘I I I Reference _
0.1 28/04/2005 I First draft for input from development team. CP3716
0.2 10/05/2005 I Includes contributions from the development
team.
1.0 20/05/2005 I Issued for approval. Incorporates reviewers
comments.

0.2 Review Details

Review Comments by :

Review Comments to :

Originator & Document Management

Mandatory Review

Mik Peach* Operations & Support Services Manager
Walter Wright* Development Team Leader
Optional Review I oe
Mark Scardifield* Development Manager

Phil Hemingway Designer

Martin Nixon Designer

Martin McConnell Developer

Phil Orton Developer

Gerald Barnes* Developer

Mike Coon Developer

Rob Dinnadge* Developer

David Leatherdale Developer

Anne Chambers*

SSC System Specialist

( * ) = Reviewers that returned comments

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE

Page: 2 of 92
FUJ00091192

FUJ00091192
oy S80 Im ationg Ref: EP/SPG/001
pact Release 3 EPOSS Counter Operational
FUJITSU Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005
0.3. Associated Documents
Reference Version I Date Title Source
PA/TEM/001 Fujitsu Services Document PVCS
Template
EP/MAN/001 EPOSS Operational Support PVCS
Guide
NB/SPG/001 NB Counter Operational PVCS
Support Guide
EA/DPR/004 This document is the Design PVCS
Proposal for the Horizon
aspects of Release Three of
IMPACT (was known as End-
to-End Re-architecting Release
2).
EA/HLD/005 Impact Release 3 Counter PVCS
Design for Balancing,
Rollover and Stock Processing
EA/HLD/006 Impact Release 3 Counter PVCS
Design for Declaration,
Correction and Revaluation
EA/HLD/008 IMPACT Release 3 Migration I PVCS
High Level Design
EA/IFS/O11 Impact Release 3 Report PVCS
Production User Interface
EA/IFS/012 Impact Release 3 Declaration, I PVCS
Correction and Revaluation
User Interface
EA/IFS/013 Impact Release 3 Balancing PVCS
and Trading Statement
Production User Interface
SD/DES/005 Horizon OPS Reports and PVCS
Receipts - Post Office Account
Horizon Office Platform
Service
SD/DOC/009 Horizon OPS Desktop PVCS
Messages and Help Text
SD/SPE/016 Horizon OPS Menu Hierarchy I PVCS
SD/SPE/022 Horizon OPS Menu Hierarchy: I PVCS

©Copyright Fujitsu Services Ltd 2005

COMPANY-in-CONFIDENCE

Page: 3 of 92
FUJ00091192

FUJ00091192
oy S80 Im ationg Ref: EP/SPG/001
pact Release 3 EPOSS Counter Operational

FU ITSU Support Guide Version: 1.0

FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005
Changes Supplement — Issue
235

RD/DES/056 Reference Data End to End PVCS
High Level Design for S80
(Impact, Track & Trace, +1
Sales)

EA/LLD/003 Counter Message Retention PVCS
Periods Low Level Design

EA/LLD/004 Counter Balancing Functional I PVCS
Low Level Design for Impact
Release 3

EA/LLD/005 In Day Transactions Low PVCS
Level Design

EA/LLD/006 IMPACT Release 3 ~ Trading I PVCS
Period Rollovers Low Level
Design

EA/LLD/007 Maintain Office Variances PVCS
Low Level Design

EA/LLD/008 IMPACT Release 3 PVCS
Transaction Correction
Application

EA/LLD/015 Impact Release 3 Receipts & PVCS
Reports

EA/LDD/019 Data Protection Low Level PVCS
Design

EP/LLD/008 EPOSS Stock Unit Low Level I PVCS
Design

EP/LLD/009 EPOSS Report Broker Low PVCS
Level Design

EP/LLD/010 EPOSS Report Processor Low I PVCS
Level Design

EP/LLD/011 EPOSS BES Reports Low PVCS
Level Design

EP/LLD/012 EPOSS Core Low Level PVCS
Design

EP/LLD/013 EPOSS Declare Low Level PVCS
Design

EP/LLD/014 EPOSS Common Low Level I PVCS.
Design

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE

Page: 4 of 92
FUJITSU

FUJITSU SERVICES

S80 Impact Release 3 EPOSS Counter Operational
Support Guide

COMPANY-in-CONFIDENCE

FUJ00091192
FUJ00091192

Ref: EP/SPG/001
Version: 1.0
Date: 20/05/2005

EP/LLD/O1S

EPOSS Settlement Object
Low Level Design

PVCS

EP/LLD/O17 EPOSS Dataserver Low Level I PVCS
Design

EP/LLD/025 Low-Level Design for BI3S80 I PVCS
MiMAN

NB/LLD/056 SoftLaunch Low Level Design I PVCS

Unless a specific version is referred to above, reference should be made to the current
approved versions of the documents.

N.B. Printed versions of this document are not under change control.

0.4 Abbreviations/Definitions

Abbreviation Definition

BP Balance Period

BTS Branch Trading Statement

CAP Cash Account Period

CBDB Counters Business DataBase (POL’s current accounting system)
EA End-To-End Architecture

EP EPOSS

EPOSS Electronic Point Of Sale System
HLD High Level Design

LLD Low Level Design

POL Post Office Limited

PM Primary Mappings

SM Secondary Mapping

TP Trading Period

™ Tertiary Mappings

0.5 Changes in this Version

Version ‘Changes
01 This is the first version.
0.2 Inclusion of contributions from development team.

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE

Page: 5 of 92
FUJ00091192

FUJ00091192
FUNITSU $80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUIITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005
1.0 Whole Document — Miscellaneous typos. Security classification set to

consistent capitalisation of “COMPANY-in-CONFIDENCE”.

Section 0.3 — Added reference SD/DOC/009. Corrected SD/SPE/022
reference.

Section 0.4 — Abbreviation added: BP, CDBD, PM, POL, SM, TM.

Section 3.1.2 — Additions to impacted components table.

Section 3.2.1 — Clarified that it is stock units and the office rather than the

counter that operate in CAP or TP mode. Clarified that it is the S80 release
that first operates in CAP mode

Section 3.2.2 — Reiterated that the accounting period moves from weekly
CAP to four weekly TP. Explained that Transaction Corrections replace the
previous manual error notice system and are part of the overall aim of
Impact Release 3 to gain better accounting control over the branches.

Section 3.2.3, 4.10.1, 4.10.3 - Made more visible the statement that
DataProtection is run by the NT scheduler not the Counter Application
Scheduler. Stated that the DailyCACT messages are no longer written

Section 3.3 — Clarified that components that are not used at $80 are still
loaded by the desktop. A few changes to the lists.

Section 4.2.3.6.2 ~ Clarified that BP1 is implicit and the change described
only applied to further BP rollovers.

Section 4.2.5 — Clarified that AccountingPeriods is in subscription group
HTH.

Section 4.2.6.3 — SoftLaunch enabling product number range specified.
Section 4.3.4 — Clarified which trailers are written when.

Section 4.3.6.2 — Fixed bad reference. Clarified that CashAccLines are not
longer written in TP mode and diagnosis should use BTS trailers and
BTSSourceData.

Section 4.7.3 — BESReport and ReportProcessor/Global Objects can both
print to the tally roll and the back office printer.

Section 4.7.6.3.1 — Expanded to describe the BTS section in more detail and
provides an example BTS.

Section 4.9.1 — Explanation as to why MaintainOfficeVariances still run.

Section 7.0 — Added further explanation re BTS CP 4002 and updated
example BTS to be one with a trading position of zero.

0.6 Changes Expected

Changes

None.

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 6 of 92
FU.
FUNITSU $80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

0.7 Table of Contents

1.0 INTRODUCTIO!

2.0 SCOPE...

0 OVERVIEW

DOCUMENTATIOD
High Level Design
Low Level Design.

EPOSS C
Migration Service ..
In-Day Service
EOD Servic

0 DETAIL...

MIMAN MIGRATION
Purpose
High Level Design...
Low Level Design.

Message Store Messages .
Reference D;

CAP TO TP MIGRATION
High Level Design
Low Level Design. .
Message Store Messages .
Reference Data
Troubleshooting.

COUNTER BALANCING

High Level Design

Message Store Messages .

Troubleshooting .
IN Day T

Purpose
High Level Design

Troubleshooting.
TRANSACTION CORRi

Purpose
High Level Design
Low Level Design.

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 7 of 92

FUJ00091192
IJ00091192
o $80 Im ationa
pact Release 3 EPOSS Counter Operational
FU ITSU Support Guide
FUUITSU SERVICES COMPANY-in-CONFIDENCE

FUJ00091192
FUJ00091192

Ref: EP/SPG/001
Version: 1.0
Date: 20/05/2005

Message Store Messages
Reference D:
Troubleshooting .
CASH DECLARATIONS & VARIANC:
Purpose .. oe
High Level Design
Low Level Desigi
Message Store Messages .

High Level Design
Low Level Design.

Message Store Messages .

High Level Design
Low Level Design.
Message Store Messages .
Reference Date
4.9.6 Troubleshooting.

4.10 DATA PROTECTIC

Purposs

High Level Design

Low Level Design

Message Store Messages
Reference D:

Troubleshooting ....
.0 ERRORS...

6.0 SUPPORT ROUTE...

0 APPENDIX —EXPLAI

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE

Page: 8 of 92
FU.
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

1.0 Introduction

The overall aim of S80 Impact Release 3 is to improve accounting control of branches. This
is addressed by two major new requirements:

e Introduction of stock handling by volume, rather than by value.

e Introduction of the (4 weekly) Trading Period rather than the (weekly) Cash Account
Period.

These changes impact the EPOSS accounting model and many EPOSS reports.

This Support Guide provides an overview of the functional changes, cross-references
associated documentation, and provides a component breakdown in order to assist fault
location, diagnosis and resolution.

This document also lists the set of errors that can be produced and their meaning.

2.0 Scope
This document limits the scope to S80 Impact Release 3 changes on the counter.

The related Support Guides are:

FUJ00091192
IJ00091192

Doc. Ref. Title Comment

EP/MAN/001 I EPOSS Operational Support Guide Written in October 2000 for the
then current EPOSS product.

NB/SPG/001 I NB Counter Operational Support Guide Covers counter = Network
Banking. Updated as S80 to
include Plus One.

AP/DOC/003 I APS Support Guide

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 9 of 92
o $80 Im . ationa
pact Release 3 EPOSS Counter Operational
FU ITSU Support Guide

FUUITSU SERVICES COMPANY-in-CONFIDENCE

FUJ00091192
FUJ00091192

Ref: EP/SPG/001
Version: 1.0
Date: 20/05/2005

3.0 Overview

3.1. Documentation

3.1.1 High Level Design

The following diagram (taken from EA/HLD/005 section 1.0) summaries the High Level
Design documents. These documents are cross-referenced in later sections.

Branch Trading
Reporting, Management
and Control and
‘Transaction

Management
Conceptual Design
EA/CDE/002

————-

IMPACT Release 3
Design Proposal
ESA/DPR/004

Reports and
Receipts

Counter Dialogues
for Impact Release 3

SD/DES/005 EA/IFS/011,012,013

Counter Balancing,
Rollover & Stock
Handling HLD
EAM/HLD/00S

Reference Data
HLD
RD/DESI0S6

Impact Release 3
S80 Migration
HLD
EA/HLD/008

Counter
Declarations,
Corrections &

Revaluations HLD

EN/HLD/006

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE

Page: 10 of 92
FU.
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

3.1.2 Low Level Design

Since S80 Impact Release 3 addresses distinct functional areas across a wide range of
components, a new set of LLDs were written, one per functional area rather than one per
component (these documents start [EA/LLD/...]).

The original component LLDs are at a very low level (these documents start [EP/LLD/...]).
Some of these have been updated where appropriate.

This full set of relevant LLDs is given in section 0.3. The following table lists all changed
LLDs and the components they impact. These LLDs are cross-referenced in later sections
where appropriate.

FUJ00091192
IJ00091192

Doc. Ref. Title Affected Components

EA/LLD/003 I Message Retention Periods BESReports.dll
EPOSSCommon.dll
EPOSSCore.dll
EPOSSDataServer.dll
EPOSSDeclare.dil
EPOSSMessage.dll
EPOSSReportBroker.dll
EPOSSSettlement.dll
EPOSSStockUnit.dll
EPOSSWatchDog.dil
LFSConfirm.dll
NBFinalise.dll
OBCS.dll
ReportProcessor.dll
TestPeripherals.dll

EA/LLD/004__I Counter Balancing EPOSSDataServer.dll
EPOSSStockUnit.dll
GlobalObjects
ReportProcessor.dil

EA/LLD/005_I In Day Transactions EPOSSCore.dil
EPOSSSettlement.dll

EA/LLD/006_ I Trading Period Rollovers (Addresses CAP I BESReports.dll

to TP transition) EPOSSCommon.dll
EPOSSDataServer.dll
EPOSSDeclaration.dll
EPOSSMessage.dll
EPOSSReportBroker.dll
EPOSSStockUnit.dll
EPOSSWatchdog.dll

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 11 of 92
FUJ00091192

FUJ00091192
S. S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
FU ITSU Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005
EA/LLD/007 I Maintain Office Variances CASEPOSSImpact.exe
EA/LLD/008 I Transaction Corrections EPOSSCore.dll
EPOSSDeclare.dll
EPOSSStockUnit.dll
EPOSSTxnCorrection.dll
EA/LLD/O15__I Receipts and Reports (Lists which reports I BESReports.dll
required change) GlobalObjects
ReportBroker.dll
ReportProcessor.dll
EA/LLD/019 I Data Protection DataProtection.exe
EP/LLD/O11 I BESReports (Appendix contains one I BESReports.dll
section per S80 Changed Report)
EP/LLD/025 MiMAN MiMAN.dIl

3.2. EPOSS Counter

The EPOSS counter breaks down into the following three services:

« Migration Service

e In-Day Service

e EOD (End-Of-Day) Service

The following sections give an overview of the changes to these services at S80 Impact
Release 3, breaking them down by functional area. Section 4.0 gives more detail on each
functional area and the components that were changed to implement that functional area.
3.2.1 Migration Service

The Migration Service handles the process of migrating a counter from a previous version of
Horizon, or from a brand-new counter, to a state ready for operational use.

At S80 Impact Release 3 migration involves:

e MiMAN Migration
When a new counter is installed, it must be “migrated” to an initial operation state.
See section 4.1 for details.

e CAP (Cash Account) to TP (Trading Period) Migration

An $80 stock unit can operate in CAP or TP mode. When all stock units have been rolled
into TP mode then the office (aka branch) can be rolled into TP mode. When S80 is first
released to the estate it will operate in CAP mode. In CAP mode, S80 mimics the

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 12 of 92
FUJ00091192

FUJ00091192
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

behaviour of S75 (with a few differences). S80 then goes through various points on a
time line, ending up operating fully in TP mode.

See section 4.2 for details.

3.2.2 In-Day Service
The In-Day service changes at S80 Impact Release 3 in the following ways:
e Counter Balancing

When transitioned into TP mode, accounting uses Stock by Volume, the accounting
period moves from weekly CAP to four weekly TP, and the Branch Trading Statement
teplaces the Cash Account.

In addition, the concept of “local suspense” is introduced. This allows a stock unit to
rollover, transferring a net cash discrepancy to office wide local suspense. The last stock
unit in an office Trading Period to rollover must clear local suspense (typically by making
good with cash).

See section 4.3 for details.
e In Day Transactions

When transitioned into TP mode, most stock must be transacted by Volume. The main
exceptions (which continue to be treated by Value) are currently:

o Cash
o Cheques
o Other Stamps
Various EPOSS components have been changed to handle transacting stock by volume.
See section 4.4 for details.
e Transaction Corrections

Transaction Corrections are messages that are distributed to branches if the central
accounting body of POL wants to perform a “correction” at the counter to correct existing
accounting values.

These replace the previous manual Error Notice system. The introduction of Transaction
Corrections is related to the overall aim of gaining better accounting control over the
branches, and the introduction of the Trading Period. Because the correction of
transactions is now automated, POL can ensure they are settled by the branch before a
Trading Period rollover is allowed.

See section 4.5 for details.
© Cash Declarations and Variances

The change of balancing mechanism from a weekly to a monthly basis necessitates the
ability to reconcile cash on a more regular basis. This impacts cash declarations,

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 13 of 92
FUJ00091192

FUJ00091192
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

discrepancy processing, and adjustments. A new Cash Variances report was introduced,
but has subsequently been dropped due to a late Change Proposal.

See section 4.6 for details.
e Receipts and Reports

A small number of reports change while still operating in CAP mode. A large number of
reports and receipts change while operating in TP mode, notably the Cash Account being
replaced by the Branch Trading Statement.

New reprint technology is introduced for the Stock Unit Balance Report and Branch
Trading Statement.

See section 4.7 for details.
© Message Retention

Messages needed for accounting purposes must be retained for at least a trading period,
and in some cases longer. The Riposte Expiry message expiry value therefore needs
increasing from the pre-S80 value of 35 days.

This issue is not strictly limited to the In Day Service, but is covered here as it is mainly
In-Day accounting transaction messages that are impacted.

See section 4.8 for details.

3.2.3 EOD Service
The End Of Day service changes at S80 in the following ways:
e CAS EPOSS Daily Recon

Simplified so that after point 50 (office in TP mode) the Mini Cash Account
reconciliation process is no longer performed (i.e. the DailyCACT messages are no longer
written).

e CAS EPOSS Weekly Recon
No longer called after point 50 (office in TP mode).

e CAS EPOSS Impact (aka Maintain Office Variances)
This is a new component.

A set of office variance persistent objects that were used by the now defunct Cash
Variances report (see 3.2.2 above) is maintained at end of day.

See section 4.9 for details.
« Data Protection

This is a new component that is different to the other EOD tasks in that it is run by the NT
scheduler rather than the Counter Application Scheduler.

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 14 of 92
FUJ00091192

FUJ00091192
es $80 Impa , ations Ref: EP/SPG/001
pact Release 3 EPOSS Counter Operational ‘
FUJITSU Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

3.3

If the earliest stock unit to roll into the current office CAP/TP did so more than a set
number of days ago, riposte archiving is disabled at end of day in order to prevent
messages that are about to expire from being deleted.

Prior to this, the user is also warned at logon to roll the office in to the next CAP/TP (this
is part of the In-Day Service, but is covered under this topic as it is closely related to Date

Protection).

See section 4.10 for details.

Components

All components are written in Visual Basic 6, unless otherwise stated below.

New code conforms to the coding standards in [NB/STD/001], although for consistency code
changes often adopt the style of their context that may pre-date the coding standards.

The following counter components are new or changed at S80:

BESReports
CABSProcess
CASEPOSSDailyRecon
CASEPOSSImpact
DailyRecon
DataProtection
EPOSSCommon
EPOSSCore
EPOSSDataServer
EPOSSDeclare
EPOSSMessage
EPOSSReportBroker
EPOSSSessionPrompts
EPOSSSettlement
EPOSSStatus
EPOSSStockUnit

EPOSSTxnCorrection
EPOSSTxnPrompts
EPOSSWatchDog
GenericPAF
GlobalObjects
LFSPServer
MiMAN

NBFinalise
NBOperationLaunch
NBOutput

OBCS

PropertyBag
ReportProcessor
SOAPWrapper

TestPeripherals

©Copyright Fujitsu Services Ltd 2005

COMPANY-in-CONFIDENCE

Page: 15 of 92
FUJ00091192

FUJ00091192
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

The following counter components are not actually used at S80, but are still loaded at desktop
boot:

e BESFallback e ScanKeys
© Scales © TrainingMode (VBS)
e ScalesConfig

The component CASEPOSSWeeklyRecon (VB5) is not used once the office is in TP mode,
but is still loaded at desktop boot.

The following counter components carry forward unchanged from $75:

© BdCCommon e LFSInterface

e BdCCore e LFSRIPInterface (C)
¢ BdCDialogue e LFSLibrary

© BdCRateBoard e LFSNVStock

« BusinessObject (VB5) e LFSView

e CASEvProducts (VB5) e NBComLib

e = CPrintMonitor.ocx (C) e NBCommon

e DC_PAFCapture e NBFramework

e DVLACommon e NBHelpers

e DVLAUtil e NBManualInput

e DVLAVRM e NBRequestReply

e DVLAOnline e NBThirdParty

e EMVInputBanking © NBValidate

e EMViInputRetail e PAFCommon

e EMVLaunch e PCDFEndOfDay (VBS5)
© EMVValidate e  Picklist

e ExtendTLS (C) e RiposeteBlobAPI (C)
¢ GenericHelpers © RiposteAPI (C)

e GenRecovery e =SoftLaunch

© Global.ocx (C) e StackStatus

e KillProcessByName (C)
© LFSEndOfDay (C)

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 16 of 92
FUJ00091192

FUJ00091192
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

4.0 Detail
4.1. MiMAN Migration

4.1.1 Purpose
MiMAN has been re-written at S80 Impact Release 3 due to reduced functionality. It now:
e Only initialises new branches (it does not migrate from pre-Horizon systems).

© No longer provides capturing of initial assets. Initial assets in an office are entered using
normal counter Remit In functionality.

e Migrates to CAP or TP mode as indicated by the accounting calendar.

4.1.2 High Level Design
The high level design is given in [EA/HLD/005] section 5.1.2.9.

4.1.3 Low Level Design
The low level design is given in [EP/LLD/025].
MiMAN is implemented in component MiMAN.dIl.

4.1.4 Message Store Messages

Various messages are written to set up the initial office, as follows :

Writes a <TranType:RollOver> marker

Writes a <TranType:CAPRollover> marker

Writes a <TranType:OpeningFiguresTrailer> trailer

For the last CAP, or any TP, writes a <TranType:BTSCFFiguresTrailer> trailer
Writes a <TranType:RolloverTrailer> trailer

Updates the <StockUnits><DEF> object to include the RolloverTrailer

Writes a <StockUnitMarkers><DEF> object

Writes an Inactive SU Rollover Event for DEF

Creates the <EPOSSCAP><Office> object

Writes report Cutoff objects for all menu items in the Office Daily and Office Weekly
menu hierarchies

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 17 of 92
FUJ00091192

FUJ00091192
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

4.1.5 Reference Data

The CAP Calendar from collection CAWeeks and the TP Calendar from collection
AccountingPeriods are read as part of the logic to determine the initial CAP or TP to migrate
into. During the S80 transition from CAP accounting to TP accounting, MiMAN will also
take into account any setting of the SoftLaunch Point 50 FINAL_CAP attribute (calculated
from the AppConfig.EPOSSStockUnit-P50A-00 object, along with the presence of any
enabling product).

The final migration status is written to collection MiMAN object ## attribute MigStatus. The
success value is C (Complete), any other value indicates migration has not been performed
successfully.

4.1.6 Troubleshooting

4.1.6.1 Diagnostics Written

Errors are written to the Audit log.

4.1.6.2 Tools
No specific diagnostic tools are available.

4.1.6.3 Fault Diagnosis
© Check the MiMAN ## object for the migration status (see 4.1.4 above).

e Check the contents of the EPOSSCAP.Office and StockUnits.DEF objects and the
associated rollover trailers (see section 4.3 for details of rollover trailers).

e Check the Audit Log for exception messages

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 18 of 92
FU.
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

42 CAP to TP Migration

4.2.1 Purpose

[EA/HLD/005] section 9.1 contains a diagram showing the timeline of the various points that
S80 Impact Release 3 goes through before operating fully in TP mode. In summary, those
that have a functional effect at the counter are:

e Point 20 — S80 code arrives at counters (S80 reference data will have arrived at a point
prior to this).

e Point 30 — Final CBDB CAP passed (happens at different times for each stock unit and
the branch).

e Point 50 — Final CAP passed / first TP entered (happens at different times for each stock
unit and the branch).

This functional area covers the changes that occur at the various points on this time line, in
terms of the counter logic and user interface.

4.2.2 High Level Design

The high level design covering the CAP/TP concepts and their transition / impact is given in
[EA/HLD/005] section 5.1.2.

The changes are in the following areas:

e Desktop status area CAP/TP legend.

© User Interface Menu Buttons.

« User Interface Messages.

« Event messages.

e User Interface Report Criteria.

e Receipts and Reports (see section 4.7).

e Internal counter logic.

There is no single place that defines what changes at which point, but see:

e [EA/HLD/008] for the wider context.

« [SD/SPE/022] for the definition of which menu buttons change at which point.
e [SD/DOC/009] for the definition of which message texts change as which point.
e [EP/LLD/011] for how BESReports reports change at the various points.

e [EA/LLD/006] for report criteria and internal counter logic.

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 19 of 92

FUJ00091192
IJ00091192
FU.
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

4.2.3 Low Level Design
The low level design is given in [EA/LLD/006].

4.2.3.1 Desktop status area

The Desktop status area is the lower right-hand area of the screen which displays several
items of status information, i.e. the name of the stock unit in use, the current user and the
current CAP/BP of the stock unit in use. When the stock unit transitions to use Trading
Periods (instead of CAPs) the ‘CAPnn BPn’ status line is replaced by a ‘TPnn BPn’ status
line. Note that whether CAP/BP or TP/BP is displayed is dependent on the current stock unit
only; other stock units, and indeed the branch, may be operating with a different CAP or TP
state. Further detail can be found in [EA/LLD/006] and is implemented in component
EPOSSStockUnit.dll.

4.2.3.2 User Interface Menu Buttons

During the migration for S80 Impact Release 3 each branch will move through various
migration points indicating the current migration level. For full details of migration points see
[EA/HLD/008}]. For a counter, various menu buttons will be altered during this migration
process to reflect altered functionality available to the user. These button alterations occur
primarily at points 20, 30 and 50. Point 50 occurs when the final CAP is rolled over into the
first TP. This will occur at different times for each stock unit and also for the branch. The
buttons altered when the branch rolls into first TP are extra to the alterations already made for
the stock units. See [SD/SPE/022] (version 235 or later) for a comprehensive list of all menu
button alterations.

The transition of User Interface Menu Buttons from CAP mode to TP mode is handled via
SoftLaunch (see [NB/LLD/056]). The design of the SoftLaunch data for menu button
transitions is described in [EA/LLD/006].

4.2.3.3 User Interface Messages

Many messages presented on screen to the user contain the text ‘CAP’. When the stock unit
of the current user is operating in TP mode then these items of text will be replaced by ‘TP’.
Certain messages relate specifically to the branch rather than a stock unit and so any ‘CAP’
text for these will only be replaced when the branch is fully in TP mode. Certain messages
will also make the distinction between the first TP and subsequent TPs, typically with the text
‘first TP’ and ‘next TP’. See [SD/DOC/009] for full details of the textual changes to
messages.

The software mechanism for making the CAP to TP message replacements is described in
[EA/LLD/006]. This transition logic (ie. which message is used at which point) is
implemented via code and fixed data in component EPOSSMessage.

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 20 of 92

FUJ00091192
IJ00091192
FU.

FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

4.2.3.4 Event messages

Similar to User Interface Messages, certain events have the text ‘CAP’ which, at the
appropriate time, will be replaced with ‘TP’. See [EA/HLD/006] for details of the textual
changes to messages.

The software mechanism for making the CAP to TP event replacements is described in
[EA/LLD/006]. This transition logic (i.e. which message is used at which point) is
implemented in component EPOSSMessage. The data to drive the CAP or TP replacement is
embedded within the event definition itself. Each event is defined within the Events
collection.

4.2.3.5 User Interface Report Criteria

For many reports the CAP value is one of the criteria which determines the report’s contents.
When operating in TP mode the CAP criteria legend is replaced by a TP legend, both for the
on-screen user interface and on the printed report.

The transition of user interface legends on Report Criteria from CAP to TP is described in
[EA/LLD/006]. The transition logic is implemented in component EPOSSReportBroker and
BESReports.

4.2.3.6 Internal counter logic.

4.2.3.6.1 CAP/TP State Interfaces

Component EPOSSCommon provides new interfaces to determine the current transition state
of stock units and the branch. Other components call these interfaces and then make
decisions impacting the user interface, reports and other counter logic. See [EA/LLD/006] for
details.

4.2.3.6.2, BP Markers

Prior to $80 all BP markers (other than BP1, which is implicit in a CAP/TP rollover) for a
stock unit were stored in a single record in the StockUnitBPMarkers collection which was
keyed on StockUnit-CAPn. Since there are likely to be more BPs per TP than there were per
CAP (since a TP is 4 times longer than a CAP) and that records in the message store have a
fixed limited size, each BP marker (other than BP1) is now stored in an individual record,
still in the StockUnitBPMarkers collection, but now keyed on StockUnit-CAPn-BPn. In TP
mode the TP number will be used rather than the CAP number. See [EA/LLD/006] for further
details.

4.2.4 Message Store Messages

No new message formats are introduced.

4.2.5 Reference Data
The following reference data objects are of note. See [EA/LLD/006] for details.

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 21 of 92

FUJ00091192
IJ00091192
FUJ00091192

FUJ00091192
ea $80 Impa , ations Ref: EP/SPG/001
pact Release 3 EPOSS Counter Operational
FUJITSU Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005
Collection Object Attribute Comment

Accounting

In group 111111111.

Periods <yyyy> is the year. Contains a calendar of
accounting periods with their associated
date ranges. Trading periods are
accounting periods offset by the value of
the BTSOffset specified in
Outlet.OutletDetails.

AppConfig EPOSSStock <tail> includes the point, and possibly

Unit-P<tail> scope, of the soft launch action e.g.
EPOSSStockUnit-P30B-SU-10.

CounterConfig I Counter CAPLegend I Contains ‘CAP’.

Params TPLegend Contains ‘TP’.

DesktopButtons I IItem<m> <n> and <m> identify the menu and

TItem<n> button.  SoftLaunch changes the in-
memory visibility attribute at the required
point.

EPOSSCAP Office TP 1=TP mode, blank=CAP mode.

TPTransition I Transitional state: final CAP or first TP.
CAP, CAP or TP values depending on the value
NextCAP, of the TP and TPTransition attributes.
PreviousCAP

MessageDefs MSGrnnn New messages that contain ‘TP’ text
replacements for ‘CAP’ text.

RepCriteria 44 New criteria to represent the selected TP
for a stock unit. TP mode equivalent of
RepCriteria.16.

StockUnits <SU Name> I TP See EPOSSCAP. Office.

TPTransition
CAP,
NextCAP

4.2.6 Troubleshooting

4.2.6.1 Diagnostics Written

e Any errors detected are written to the Audit log.

©Copyright Fujitsu Services Ltd 2005

COMPANY-in-CONFIDENCE Page: 22 of 92
FUJ00091192

FUJ00091192
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

* No new events are raised.

4.2.6.2 Tools
No specific diagnostic tools are available.

4.2.6.3 Fault Diagnosis

The following section describes some useful information about the mechanics of the CAP to
TP transition that may help in performing fault diagnosis.

Stock Unit roll expected to enter TP mode but did not
The final CAP for every stock unit in a branch is determined by SoftLaunch data in :-
AppConfig.EPOSSStockUnit-P50A-00

This record lists all possible candidate final CAPs. A non-core product will be used to select
a single entry from the list to be used at a particular branch (these product numbers are in the
range 6247 through 6266 inclusive). When that final CAP is rolled out of then the stock
unit/branch should enter the first TP, and thus TP mode.

Entry into TP mode might be delayed if the AppConfig data is missing, the appropriate non-
core product is not present or the AppConfig data was not present on the counter in good
time. The AppConfig data needs to be present before rolling into the final CAP; if it arrives
after rolling into the final CAP then the transition will still occur but it will be delayed by
one, or more, CAPs.

Selection of first TP

When rolling out of the final CAP the selection of the first TP will be made in this manner :-
What would have been the next CAP is determined,
The start date for that CAP is looked up,

The TP that covers that start date is found from checking the AccountingPeriods
collection and is then used as the first TP. Note that the BTSOffset from
Outlet.OutletDetails adjusts the start/end dates of the AccountingPeriods.

How to determine the CAP/TP state of a stock unit or branch

Every stock unit has a record in the StockUnits collection, keyed on the stock unit’s name,
which contains much of the state data for the stock unit. In each of these records the state of
that stock unit’s individual CAP/TP mode transition is maintained. This involves 2 new
attributes introduced in $80, namely TP and TPTransition.

Note that either of these attributes being absent is treated as though it were blank.
The TP attribute taken alone indicates whether the stock unit is in CAP or TP mode.

TP:blank => CAP mode
TP:1 => TP mode

If taken together the two new attributes can provide a slightly more detailed picture :-

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 23 of 92
FU.
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

TP:blank and  TPTransition:blank => before final CAP

TP:blank and = TPTransition:1 in final CAP

TP:1 and = TPTransition:1 => in first TP

TP:1 and = TPTransition:blank => after first TP
A similar set of attributes exist to determine the CAP/TP state of the branch; they are located
in the following record :-

EPOSSCAP.Office

Counter slow during user logon, or SU rollover, or SU attachment

During the transition to a fully migrated Impact Release 3 branch there are periods when the
stock units could be in differing migration points. For example, at Point 50 a branch may
contain some stock units still operating in the final CAP, thus operating in CAP mode, and
other stock units that have rolled into the first TP, and thus operating in TP mode. The set of
menu buttons presented to the user is different between CAP and TP mode. Therefore if a
counter has to switch between stock units then it must alter the menu buttons according to the
mode of the new stock unit. This alteration is performed via SoftLaunch and can take several
seconds to complete. This alteration may happen during user logon, stock unit rollover or
stock unit attachment.

Unexpectedly rolling into TP 13 (or above)

If, when rolling a stock unit in TP mode, the next TP selected is TP13 (or above) then this
means that the AccountingPeriods data for the following year was not available at the counter
and the counter has therefore rolled into a stopgap ‘virtual’ TP. Further rollovers will go into
incrementing TP numbers until the problem with the missing AccountingPeriods data has
been resolved.

Unexpectedly rolling into TP61 (or above)

If, when rolling a stock unit currently in a CAP range of 1 to 6 into the first TP, the TP
selected is 61 (or above) then this means a ‘bias’ has been added to the normal TP number to
make it distinct from the low numbered CAPs in which the counter had previously operated.
The bias value added is typically 60. For the remainder of that year all TPs in that branch will
also be biased, i.e. rather then TPs going from I to 12 they will instead go from 61 to 72.
When rolling into the next year the biasing will no longer be applied.

AccountingPeriods collection in subscription group LL1111111

The AccountingPeriods collection contains the calendar for the accounting periods and thus
the trading periods. It is the replacement for the CAWeek calendar when in TP mode. Note
that the data for the AccountingPeriods collection exists in a subscription group unlike many
items of reference data. Creating dumps of messages stores may need to cater for this to
ensure that AccountingPeriods data is dumped.

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 24 of 92

FUJ00091192
IJ00091192
FUJ00091192

FUJ00091192
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

43 Counter Balancing

4.3.1 Purpose

The purpose of this functional area is to incorporate the new Stock By Volume and Trading
Period requirements in to the EPOSS counter balancing logic.

This involves:

e Stock by volume changes

e Performance improvements

¢ Provision of figures for the Branch Trading Statement
e Reports (see section 4.7)

e Suspense using POL settlement products

« Local Suspense

4.3.2 High Level Design

The low level design is given in [EA/HLD/005] (see most of the document, but exclude
reports and reprints which are covered in section 4.7 of this support guide).

User interface changes are given in [EA/IFS/013] sections 2 and 4.

4.3.3 Low Level Design
The low level design is given in [EA/LLD/004].

As described in [EA/HLD/005] new versions of the accumulators SV (Sale Value), QTY
(Quantity) and RC (Record Count) are introduced in to the accounting node hierarchy, post-
fixed by NTM (No Tertiary Mappings — for TP mode Value Stock and Non-inventory Stock
transactions) or ETM (Extant Tertiary Mappings — for TP mode Volume Stock transactions).
The accounting model is implemented in component EPOSSDataServer.dll.

New rollover trailers and user interface handling is implemented in component
EPOSSStockUnit.dll.

EPOSSStatus.dll is an interface that shields EPOSSStockUnit from accessing
EPOSSDataServer directly. It also manages a common instance of an EPOSSDataServer
handle to be shared between EPOSSStockUnit, ReportBroker, and ReportProcessor.
EPOSSStatus has been updated to reflect minor interface changes. ReportProcessor has been
altered to accommodate the new accumulator types as well as changes to payments / receipts
checks.

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 25 of 92
FUJ00091192

FUJ00091192
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

4.3.4 Message Store Messages

The stock unit and office rollover trailers have additional opening figure trailers (largely
introduced when rolling in to the first TP to support the BTS) — see the following sub-
sections for details.

The various opening figure trailers follow their opening figures. The opening figures id
consists of GroupId_Nodeld_Msgld (e.g. 90177_1_ 38985) where Msgld is the id of the first
opening figure transaction.

43.4.1 Stock Unit Rollover Trailers

StockUnits
Collection

Object Name
—
Stock Unit
Object

RolloverTrailer pointer (for I CAPRolloverTrailer pointer
latest CAP/TP or BP rollover) I (for latest CAPYTP rollover).

TranType:RolloverTrailerI
Message

Trailer pointer

Opening Figure
Trailer Message

Messages keyed by OpeningFiguresid

OpeningFigure
Data Message

The following RolloverTrailer message has the following general attributes:

Attribute Comment
BP The CAP/TP number being rolled in to.
CAP The CAP/TP number being rolled in to.

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 26 of 92
FUJ00091192

FUJ00091192
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

CAPRollover

A pointer to a message with TranType:CAPRollOver
containing a marker for the start of the CAP/TP.

Container The stock unit name.

LastCAP The last CAP/TP number.

Previous Points to the previous CAP/TP or BP Rollover Trailer.
PreviousCAP Points to the previous CAP/TP rollover Trailer.

Rollover A pointer to a message with TranType:RollOver

containing a marker for the start of the CAP/TP or BP.

The RolloverTrailer message has the following attributes that are pointers to opening figures

trailers:

Attribute Opening Figure Opening Figure Data Messages
Trailer Message
TranType

BTSCFFiguresTrailer I BTSCFFiguresTrailer BTS line value messages. Used by the

BTS for the C, D, E, G, H and Y sections.

Written when rolling into the first TP, and
on subsequent rollovers.

CurrentBTSBFFigures
Trailer

BTS line value messages, copied from the
previous rollover’s PreBTSBFFTrailer.
Used by the BTS for the B section
(excluding Lines BBB and BBBB which
are read from the office rollover
CurrentBTSBFFiguresTrailer see section
4.3.4.2).

Written when rolling into the first TP, and
on subsequent rollovers.

DeclarationIds

DeclarationTrailer Brought forward declarations; EPOSS
Transactions for declaration products (aka
STX messages).

Written on CAP and TP rollovers (as pre
$80).

NonInventory

RemProductsTrailer Brought forward values of non-inventory
product sales (i.e. Products with I:False
e.g. Parcel Traffic) and movements (i.e.
Remittances / Transfers). These figures
are harvested, but otherwise are not used.

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 27 of 92
FUJ00091192

FUJ00091192
ea $80 Impa , ations Ref: EP/SPG/001
pact Release 3 EPOSS Counter Operational ‘
FUJITSU Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

Written on CAP and TP rollovers (as pre
$80).

OpeningCAProduction
FiguresOnly

OpeningFiguresTrailer

Brought forward stock holdings in CAP
style (stock by value); EPOSS
Transactions messages.

Written only on rollover in to first TP, and
not on subsequent rollovers.

OpeningFigures

OpeningFiguresTrailer

Brought forward stock holdings; EPOSS
Transactions messages.

Written on CAP and TP rollovers (as pre
$80).

When rolling into the first TP, and on
subsequent rollovers, Volume Stock
transactions have VolS:True and
SaleValue:0.

PreBTSBFFTrailer

CurrentBTSBFFigures
Trailer

BTS line value messages. Values
calculated for the BTS B section, not used
directly by the BTS but copied at the next
rollover to become the
CurrentBTSBFFiguresTrailer.

Written when rolling into the first TP, and
on subsequent rollovers.

SuspenseTrailer

SuspenseTrailer

Brought forward values of suspense
products; EPOSSTransactions that also
have <SuspenseContainer:$$>.

Written on CAP and TP rollovers (as pre
$80).

The details of the above messages are given in [EA/LLD/004].

©Copyright Fujitsu Services Ltd 2005

COMPANY-in-CONFIDENCE

Page: 28 of 92

FUJ00091192

FUJ00091192
rT $80 Im ations Ref: EP/SPG/001
pact Release 3 EPOSS Counter Operational
FUJITSU Support Guide Version: 1.0
FUIITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005
4.3.4.2 Office Rollover Trailers

EPOSSCAP
Office Object

RolloverTrailer: points to
latest RolloverTrailer

T
I CAP Trailer: points to
I laces CaPTralr

TranType:RolloverTrailer}
Message

TranType:CAPTrailer
Message

10 RolloverTaler.

TranType:...
Trailer Message

Messages keyed by OpeningFigurestd

TranType:...
OpeningFigure Message

Trailer pointer \/

RolloverTrailer: pointer

_

Previous: pointer to
previous CAPTrailer

TranType:
CashAccountTrailer
Trailer Message

Messages keyed by OpeningFiguresId

TranType:C
OpeningFigure Message

The RolloverTrailer message has the following general attributes:

Attribute Comment

CAP The CAP/TP number being rolled in to.

CAPRollover Pointer to message with TranType:CAPRollover that
contains a marker to the start of this CAP/TP.

Container Ht

The RolloverTrailer message has the following attributes that are pointers to trailer messages:

©Copyright Fujitsu Services Ltd 2005

COMPANY-in-CONFIDENCE

Page: 29 of 92
FUJ00091192
FUJ00091192

oy S80 Imp2 si ationa Ref: EP/SPG/001
pact Release 3 EPOSS Counter Operational
FUJITSU Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005
Attribute Opening Figure Opening Figure Data Messages
Trailer Message
TranType
CurrentBTSBFFigures I CurrentBTSBFFigures I BTS line value messages. Used by the
Trailer Trailer BTS for suspense brought forward (Lines
BBB and BBBB).
Written when rolling into the first TP, and
on subsequent rollovers.
DeclarationTrailer DeclarationTrailer Keys office opening declarations:
messages with <Container:##>.
Written only in CAP mode; i.e. not written
on rollover in to first TP and subsequent
rollovers.
OpeningFigures CAP mode: In TP mode (i.e. on rolling over into first
OpeningFiguresTrailer I TP) this only keys suspense brought
Ss Trail eee .
uspense trailer EPOSSTransaction.SuspenseContainer:$$
>.
In CAP mode it also keys stock holdings
for all stock units; messages with
<Container:#4#>.

The Cash Account Trailer is only written until the final cash account is produced.

After the above ## figures are written, #1 figures are also written. The latter are a summation
of the figures from the various stock units, unlike the ## figures which are a concatenation.
The #1 figures are used by the Office Snapshot and other office wide searches and reports.
No trailer points to the #1 figures; the OpeningFiguresId is found by scanning for the first #1
message from the CAP marker.

The details of the above messages are given in [EA/LLD/004].

43.5

The following new/changed persistent objects are used:

Reference Data

e EPOSSStockUnit/Parameters includes new local suspense configuration

e EPOSSStockUnit/OfficeVariances defines suspense and transaction correction queries
The following collections remain central to the use of EPOSSStockUnit:

« EPOSSCAP

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 30 of 92
FU.
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

« EPOSSDNodes

© EPOSSNodes

«© EPOSSProducts

e EPOSSStockUnit

© = StockUnits

© StockUnitMarkers

¢ = StockUnitBPMarkers

4.3.6 Troubleshooting

The major differences between the Stock balancing rollovers produced pre-S80 and those at
S80 lie in the production of:

43.6.1 Figures relating to Volume Stock

At point 50 only, opening figures are converted from sale value type stock to volume stock
only where the stock is indicated as being volume stock. Should the reference data for a
product arrive late when the stock unit rolls into the first TP, then there is danger that a
product could roll with a combination of volume and a residual sale value also. This situation
will not be easily rectified without a special transaction introduced that will have zero
quantity which does not disturb the stock holdings, but has a contra sale value will eliminate
the residual value carried forward. Such a transaction would have to be specially prepared by
SSC staff and run in with the likes of the Riposte tool ‘rclient.exe’; this action might need
POL authorisation.

4.3.6.2 New figures and trailers for the ‘Branch Trading Statement’.

The Stock unit rollover process will feed figures through to the Branch Trading Statement
report, see 4.7.6.3.1 for details of these new trailers. Figures are prepared in line with table
objects within the collection BTSSourceData. The figures for each line are based on a
formula for one or more EPOSS Nodes accumulations; these nodes may be a variety of
accumulate type based on sale value, quantity or row count. Brought forward figures (i.e.
previous period’s figures) are calculated in the previous rollover to current, but are re-linked
into the current period’s figures. Therefore the figures for the BTS must have the correct
BTSSourceData in place at the very least in the CAP prior to point 50, otherwise the brought
forward figures will not be accurate.

For fault diagnosis, in CAP mode the pre S80 CashAccLines are present. In TP mode, these
are no longer produced and the BTS rollover trailers and BTSSourceData must be examined
(see section 4.7.6.3.1).

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 31 of 92

FUJ00091192
IJ00091192
FUJ00091192

FUJ00091192
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

4.3.6.3 Last Cash Account

At point 50 a one off trailer is written that points to a set of opening figures specially
prepared for the last Cash Account. Figures that would normally be shareable between the
existing balance snapshot/balance report process (for subsequent actions after a rollover) and
the Cash Account diverge after point 50, hence the need for the last trailer. In the CAP
Rollover trailer at point 50 a trailer will exist called the “OpeningCAProductionFiguresOnly”
to supplement (and not replace) the “OpeningFigures” trailer.

43.6.4 Diagnostics Written

e Windows events are written — see section 5.1.

e Audit log lines are written — see section 5.2.
43.6.5 Tools

4,3.6.5.1 Check Balance

Pre-S80, there were three previous means of reconciling the balancing process against the
counter balancing code:

e CheckBalance tool.

e EOD counter cash account reconciliation © (CASEPOSSDilayRecon and
CASEPOSSWeeklyRecon).

e Agent reconciliation based on harvested Cash Account trailers, ie. the host recalculated
cash account.

All of these reconciliation means are no longer available with S80 working in TP mode.

4,3.6.5.2 Analyse Rollovers

The tool AnalyseRollover trailers can be used on a loaded message store to show:
© The current CAP/TP and BP for the office and each Stock Unit.

e The previous rollovers for the office or a selected Stock Unit.

e The rollover trailers for a selected rollover together with their opening figures (CAP
mode specific trailers are not shown — this tool is intended for analysing TP mode
rollovers).

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 32 of 92
FUJ00091192

FUJ00091192
FUNITSU $80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

eg.

iw, Analyse Rollovers

‘SU SU2 TP:8 BP:1

Groupld:1 7461 3><Id:1><Num:1 4256> 25-Oct-2005 15:17:29 SURolloverTrailer CAP Started 8 BP:1
<Groupld:1 7461 3><Id:2><Num:2187> 24-Oct-2005 16:03:33 SURolloverTrailer. CAP Started 7 BP:1

<Groupld:1 7461 3><Id:2><Num:2003> 24-Det-2005 11:41:52 SURolloverT railer: CAP Started 34 BP:1
<Groupld:1 7461 3><Id:2><Num:1 620> 21-Oct-2005 17:10:22 SURolloverT railer: CAP Started 33 BP:1
Groupld:1 7461 3><Id:2><Num:1 396> 20-Oct-2005 17:13:06 SURolloverT railer: CAP Started 32 BP:1
Groupld:1 7461 3><Id:1><Num:3082> 20-Oct-2005 12:21:00 SURolloverTrailer: CAP Started 31 BP:1

43.6.6 Fault Diagnosis

e Use the above AnalyseRollovers tool to identify the message range for the CAP/TP and
BP in question.

e The actual transactions that have been performed during a Stock Unit CAP/TP need to be
analysed (as pre S80) in order to check the values for a carried forward figure or an
accounting node value.

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 33 of 92
FUJ00091192

FUJ00091192
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

44 In Day Transactions

4.4.1 Purpose

In order to implement the high level requirement to handle most stock by volume rather than
by value, changes are needed to the transaction attributes for Volume Stock.

The following changes are needed to the way transactions are conducted when in TP mode:

e Products now handled by volume have a new Tertiary Mappings (TM) attribute, which
contains a set of accounting node mappings into the Receipts accounting hierarchy. In TP
mode these mapping are used instead of the existing Primary Mappings (PM) attribute
which maps to the Value Stock & MOP accounting hierarchy.

e Volume stock movements (i.e. stock transacted in Remittance or Transfer modes) record
a zero sale value.

¢ Settlement products used in transactions will now be POL products rather than POA
products.

e APS transaction will now use EPOSSCore in order to utilise the above new volume stock
changes.

4.4.2 High Level Design
The high level design in given in [EA/HLD/005] section 5.1.4.

The following diagram (adapted from [EA/HLD/005] section 5.1.7) shows the accounting
hierarchy and the use of Tertiary mappings.

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 34 of 92
FUJ00091192

FUJ00091192
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005
Balance LL Payments Total Receipts
[3009] [3008] [3016] [303]
wor I [3003] [so]
Value & Volume
/ \ Other “— Product Node
en
ne tock
Prec ws Volume Stock Prodhiet Node vin ts
Subgroups copied asa structure piniily
(by TM) to the Receipts structure, / \
new nodes being crented
The following diagram shows the various stock types.
I:True I:False
Inventory Stock VolS:False
VolS:False VolS:True Non-inventory Stock (no _ intrinsic

value until issued. Accounting is only
about the sale value not the stock)

PM maps into 3006 or 3016
No TM

Value Stock Volume Stock

PM maps into 3008 & I PM maps into 3008 &
below, and 3013/3016 I below

& below TM maps into 3013 &
No T™ below

4.4.3 Low Level Design

The low level design is given in [EA/LLD/005].
The changes are implemented in components:

e EPOSSCore

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 35 of 92
FUJ00091192

FUJ00091192
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

«© EPOSSSettlementObject
e APS [outside the scope of this document]
[EA/HLD/005] and [EA/LLD/005] define which change is made in which component.

The existing but undocumented EPOSSCore interface for obtaining transaction attribute
grammar stings and selling a product is now documented in [EA/LLD/005].

4.4.4 Message Store Messages
Example transaction messages are given in [EA/LLD/005].

Volume stock transactions include the attribute “EPOSS Transaction. VolS:True”.

44.5 Reference Data

No new collection or objects are introduced, but the existing collections remain relevant (e.g.
EPOSSProducts, EPOSSNodes, ModeParameters, ProductModes).

4.4.6 Troubleshooting

44.6.1 Diagnostics Written

EPOSSCore writes some error and diagnostic information to the Windows Event log (see
section 5.1), the Audit log (see section 5.2), and in addition can write some System Errors
(see section 5.3).

EPOSSSettlement has very few occurrences of writing to the Windows Event log, the Audit
log, and of writing System Errors.
44.6.2 Tools

Riposte tools are available for viewing transactions written to the message store e.g. Riposte
Message Spy, Riposte Tail, Riposte Scan Message, Ripose Query, Object Editor, Attribute
Convertor etc.

44.6.3 Fault Diagnosis

Fault diagnosis is unchanged; the transactions in the message store and the various
accounting collections should be examined.

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 36 of 92
FU.
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

45 Transaction Corrections

4.5.1 Purpose

A transaction correction request is sent electronically from the central accounting body of
POL to a branch in order for the branch to perform a “correction”, transacting a supplied
product against a supplied settlement product (or other supplied options).

On logon, the user is informed if there are outstanding transaction correction requests that
require processing (provided the user has the appropriate role). A button is provided at this
point which can be used to enter the Transaction Correction User Interface.

The Transaction Correction User Interface can also be entered via the Housekeeping menu
(which is also only available to users with the appropriate role).

The Transaction Correction User Interface lists outstanding transaction corrections, and the
user can select one. The details are then displayed and various options provided to the user to
process and (in some cases transact) the transaction correction.

Two reports are available on the Reports menu to show Outstanding Transaction Corrections
and Processed Transaction Corrections.
4.5.2 High Level Design

The high level design is given in [EA/HLD/006] section 4.5, and the user interface for
transaction correction processing is given in [EA/IFS/012] section 2.1.3, 2.4 and 4.3.

The Outstanding Transaction Corrections report and the Processed Transaction Corrections
Report are defined from a design perspective in [EA/IFS/012] section 3.4, with examples
listed in [SD/DES/005]. See the Reports and Receipts section 4.7.

4.5.3 Low Level Design

The low level design is given in [EA/LLD/008].

The following components implement this functional area:

EPOSSCore Provides interface for transaction validation.
EPOSSDeclare. Include Transaction Corrections.
EPOSSStockUnit Logon check linkage.

EPOSSTxnCorrection User interface and processing logic.

EPOSS WatchDog Provide interface to check counter isolation status.

MaintainOfficeVariances Count transaction corrections processed and write to
VarianceHistory objects.

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 37 of 92

FUJ00091192
IJ00091192
FUJ00091192

FUJ00091192
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

If a transaction correction fails to be transacted, a general failure message is displayed to the
user.

4.5.4 Message Store Messages

The relevant messages are (see [EA/HLD/006 section 4.10.4] and [EA/LLD/008] for details):
e Transaction Correction Request message (WAIndex.LFSFlag:TC).

e Transaction Correction Processed message (WAIndex.LFSFlag:TP).

The event messages are (see [EA/HLD/006] for details):

¢ Outstanding Transaction Correction Reminder Displayed (Event ID 62)

4.5.5 Reference Data
The relevant collections and persistent objects are:
« EPOSSStockUnit / TCParams

Used by Transaction Correction Processing logic and roles. See [EA/LLD/008] for
details.

e EPOSSStockUnit / Office Variances

Attributes TxnCorrRequests and TxnCorrProcessed define Riposte queries. See
[EA/HLD/006] for details.

© ModeParameters

Six new modes for transacting Transaction Corrections. See [EA/LLD/008] for details:

o AN Assign Nominee
o EV Request Evidence
o HD Plead Hardship

o MG Make Good.

o SW Stock Write Off
o WO Write Off

4.5.6 Troubleshooting
4.5.6.1 Diagnostics Written
No specific diagnostics are written to the event log or audit log.

4.5.6.2 Tools

There are no specific diagnostic tools.

45.6.3 Fault Diagnosis

Be aware of the following when diagnosing faults:

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 38 of 92
FUJ00091192

FUJ00091192
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

¢ It is not possible to reverse a correction transaction. However an erroneous correction
transaction could be negated by POL FS producing a fresh correction request with
opposite sense.

e The counter is locked during Transaction Correction processing, so that one cannot
transfer the session. Locks also prevent someone processing the same Transaction
Correction at the same time on multiple counters. It is not permitted to perform
Transaction Correction processing on an isolated counter (one that is not, and cannot
contact, the Gateway).

e Transaction correction request messages must come from the correspondence server (i.e.
node id > 31), and transaction correction processed messages must originate from a
counter (i.e. node id < = 31).

« Generated correcting transactions are distinct because they can only be created in one of
the specific new modes that are peculiar to Transaction Correction processing.

e Generated correcting transactions are also distinguished by other attributes in messages
including a secondary mapping. For a full description and justification see [EA/HLD/006]
section 4.5.

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 39 of 92
FU.
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

46 Cash Declarations & Variances

4.6.1 Purpose

In order to reconcile cash on a regular basis, the following changes have been made (in
summary):

e Cash Declarations will now continue to exist until declared with zero cash, in which case
they will be logically deleted at the next desktop load (overnight).

e The Overnight Cash Holding (ONCH) declaration mechanism is replaced with the normal
Cash Declaration mechanism.

e New Add/Remove Cash buttons are introduced to allow a cash discrepancy (aka variance)
to be rectified at any time prior to stock unit rollover.

e A new Cash Variance button is introduced to check for a cash discrepancy for shared
stock units.

A new Cash Variances report was provided and tested, but was dropped by a late POL
Change Proposal. The report listed stock unit cash discrepancies, cash declarations, cash
variance transactions and transaction corrections. It derived its figures from the EOD process
MaintainOffice Variances (see section 4.9).

In addition, changes have been made to Stock Declaration and Adjustment, Non Value stock
handling, and Revaluation.
4.6.2 High Level Design
The high level design is given in [EA/HLD/006] section 4.1, 4.2, 4.3, 4.4 and 4.8. The user
interface changes are given in [EA/IFS/012] section 2.1.2, 2.2, 2.3 and 4.2. The button
changes are given in [SD/SPE/022].
4.6.3 Low Level Design
The above functionality is implemented in component EPOSSDeclare. The low level design
is given in [EP/LLD/013].
4.6.4 Message Store Messages
Declaration objects:

Collection: Declaration_sss, ObjectName: ii_d nn (Shared stockunits)

Collection: Declaration_sss, ObjectName: d nn (Individual stockunits)

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 40 of 92

FUJ00091192
IJ00091192
FU.

FUNITSU $80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0

FUJITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

Variance objects:
Collection: Variance_ww, ObjectName: FG_sss

Collection: Variance_ww, ObjectName: FG_sss_ii (Shared stockunits only)

Declaration messages
Event messages:
ID 58: Remove Excess Cash
ID 59: Cash Made Good
ID 63: Variance check with no Discrepancy

ID 64: Variance Check with Discrepancy

In all the objects and messages described above, the following keys apply:
SSS - Stockunit identifier
ii - Declaration ID

d - Drawer item type (2 = Stock, 3 = Stamps, 4 = Cash, 6 = Currency,
8 = Travellers Cheques Unsold)

nn - Node Id

ww Week number (calendar week of the year)

4.6.5 Reference Data

The variance history objects are created and maintained by EPOSSDeclare. They are defined
in [EA/HLD/006] section 4.10.3. They are held in reference data collection Variance_ww
where ww is the variance week number.

4.6.6 Troubleshooting

4.6.6.1 Diagnostics Written

EPOSSDeclare writes some errors and warnings to the Windows Event log (see section 5.1)
and the Audit log (see section 5.2).

4.6.6.2 Tools

The variance week number is in the range I through 53. It starts at 1 for the week
commencing the first Thursday of the calendar year. It can be calculated for any given date
using the VarDate.exe test tool. See [EP/LLD/011] section 14.3.3.9 regarding the Cash
Variances Report diagnostics for details.

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 41 of 92

FUJ00091192
IJ00091192
FUJ00091192

FUJ00091192
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

4.6.6.3 Fault Diagnosis

No change to fault diagnosis is needed; the initial requirement is to check the transactions
written to the message store.

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 42 of 92
FUJ00091192

FUJ00091192
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

4.7 Receipts and Reports

4.7.1 Purpose
The EPOSS counter produces a wide range of Receipts and Reports output using the:
e Tally Printer (also used as a slip printer for pre-printed stationery and labels)

e Back Office A4 Printer (S80 introduces A4 landscape reports in addition to A4 portrait
reports)

e Preview (S80 introduces A4 landscape preview in addition to A4 Portrait preview, Pre-
printed stationery Slip preview and Tally Roll preview)

4.7.2 High Level Design

The layout and user interface for reports changed at $80 is given in [EA/IFS/011].

A sample of each report showing the report layout is given in [SD/DES/005].

The high level design of Non-value Stock, Variance, Transaction Correction and
Remuneration reporting is given in [EA/HLD/006].

The high level design of Stock Unit, Suspense Account and Branch Trading Statement
teporting is given in [EA/HLD/005].

4.7.3 Low Level Design

The EPOSS counter uses four means to display the print user interface and print reports:

e Report Broker, Report Processor, and Global Objects

e BESReports

e LFSConfirm and LFSPServer

«© XSLT (Report or receipt defined in XSLT, then printed via Report Processor and Global
Objects, using Blank ‘Skeleton’ Report)

e Printing to the Tally Roll printer and to Preview is via Peripheral Server. Printing to the
Back Office printer is via the Visual Basic Printer object to default Windows printer.

There are some circumstances in which ReportBroker handles the initial user interface, and
then routes to BESReports for actual printing.

The entire set of reports and the changes made at S80 are listed in [EA/LLD/015]. This
defines which reports use the Global Objects route, which use BESReports and which use
LFSPServer.

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 43 of 92
FUJ00091192

FUJ00091192
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

The low level design of BESReports is given in [EP/LLD/011]. This has been updated at S80
with an Appendix that lists each changed report and provides detail on the code paths,
interfaces and low level design.

The Pre-S80 low level design of ReportBroker is given in [EP/LLD/009], and the Pre-S80
low level design of Report Processor is given in [EP/LLD/010].

Reprints of the final Stock Unit Balance Report and the final Branch Trading Statement are
changed to use a BLOB (Binary Large OBject) reprint mechanism (Riposte
PutObjectWithASCHAttachment). The Stock Unit Report BLOB data is written by
ReportProcessor, and the Branch Trading Statement BLOB data is written by BESReports.
The reprint user interface is handled by ReportBroker, but the BLOBs for both reports are
tead (using Riposte GetASCIIMessage Attachment) and printed by BESReports.

4.7.4 Message Store Messages

GlobalObjects, LFS and BESReports write EPOSS event messages whenever a report is
previewed or printed (<EPOSSTransaction.TranType:E>). In addition completion of report
printing writes a PrintInfo message to the message store, with PrintInfo.Success:1 for success
and 0 for failure.

4.7.5 Reference Data

The various reports use a variety of collections and persistent objects. See [EP/LLD/011] and
[EP/LLD/009] for details.

4.7.6 Troubleshooting

4.7.6.1 Diagnostics Written

The audit log (not the Windows Event log) can contain diagnostic information (see section
5.2). Some reports write significant diagnostic information to the audit log (see the sections
under Fault Diagnosis below).

The Peripheral Server log contains the print data sent to the Tally Roll printer
(c:\counters\temp\PSStandard.log).

JPEG page images of the last previewed report are held in c:\counters\spool.

4.7.6.2 Tools
See the sections under Fault Diagnosis below.

4.7.6.3 Fault Diagnosis

To determine when a report was printed, and its outcome, check for the report printed events
messages in the message store.

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 44 of 92
FU.
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

Tf the fault is in the user interface, determine whether ReportBroker or BESReports displays
the user interface (see [EA/LLD/015] or check the destination component on the menu
button).

If the fault is in the report, determine whether BESReports, LFS or GlobalObjects produces
the report in question, and whether is it a Back Office or Tally Roll report.

The following sections cover the most significant reports out of those that are new or have
been re-written at S80 Impact Release 3.

4.7.6.3.1 Branch Trading Statement

This report (and the associated report / office rollover user interface) is handled by
BESReports.

Figures printed on the Branch Trading Statement are derived using equations held in the
BTSSourceData reference data collection. Two equations (or “methods”) are used for each
figure: a source method and a print method. The source method is used by EPOSSStockUnit
and contains an equation using accounting nodes and/or products. The calculated value is
written out as a BTS trailer during stock unit rollover. The print method calculates the value
to be printed using these BTS trailer values and/or values already calculated by previous print
methods. For details see [EP/LLD/011].

The BTS has two major sections:
e¢ The Summary section

e The Stock Holdings section

47.6.3.11 Summary Section

The Summary section reports accounting information with columns for the Branch Total,
Suspense and Stock Units. The branch total column is the sum of columns to the right.

Below is an example BTS summary section, spanning two pages.

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 45 of 92

FUJ00091192
IJ00091192
FUJ00091192
FUJ00091192

FUNITSU $80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0

FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005
sereveot rap eanaste rage 3
TERS aa vas0e Pot

Teast Branch Trading facsnens - Oftace Copy From 28/21/2008 Te 9/11/2008

Sennen Total suspense 6 4 sv at su ex ma

Sash on Hand B Feat eas 4830.79 a) $039.60 38.90
Gash Awaiting Collection B Pod 23
deker BOP 3 od 2.90 9.00 ene 0.90
forks Bed 8180 3.69, ” 510
Scher Bostage B fod ssa. 30 oles 40618 9100
fensveances In Tatat 9.09 2.00 2.00 e0e 9.90
fa eon oe Si0a © 06
200/09 3198 3.60 ae 20029
3.00 ose Exey ete 9:20
deka Pecesper coer) rose zeae clea atoo
stesisee Oar toed 309.09 2.00 00 eee 209.90
aah Foucher Deryatched van Sr £0903 e006
keaves toofeom Stepanse 9.03, 2.00 0.00 2.00 o.0¢ 2.90
Fash fens ve Cuspenee oes Sloe 3.60 eee 2:80
Exancfarr duc te ether Ste 298 820 bleo e108 2:80
Duinee Dayuanes aas8.98 a senee ee 513.00,
fae on Mand © Ped 2167.67 sire. 2.09 5237.84 9.00
Shah Ruateing Collection © od 09/09. 0000.
= 532.00"
2.90 2.00 eve 20
e038 otto elo 9100
65.99 2.0 06142 8190
Teading postion 447) e.00 2.00 c.06 0.00
Bassvapancy SHORT Teanstersed oan e
Discrepancy GUE Zerolvas 0 e
Dabcrepancy SHORT Resolved caer 6
Exenes Cath Recon’, 2.90 9.00 c.06
Gash shortage fade Sood 2.00 eo e206
vead pap eacises Page &
‘58. 29/21/2008 Pot

Teas Beanah Trading Seavonant ~ OL¢iee Copy Prem 26/41/2005 Te 29/11/2008

su sie
ex thane 2 Pod 24800048

Eee huaiting Collection B Pod

Suspense B Fes

beher ROY 2 od o.09
Pooks B Fed 8.00
chee Posvage 8 fwd Poets

9.09

fash Touches Despacched
Tnanefare Te trom ccher 80s
einer ecespes

Peniteances 02

patched vie sue

alas

poesterrd

2.00

anaterned 2.08

Discrepancy SHOET Resolved Sica
Excare Cash Rencuns. 2.09
Gash Shortage Bade ood oiea
Toval Branch adjuoemence 9.09

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 46 of 92
FUJ00091192

FUJ00091192
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

The summary section is divided into the following sub-sections, which are separated by blank
lines:

Section Description Defined by BTSSourceData
objects starting with “Line”
followed by letter:

Brought Forward Figures

Receipts Movements

Payments Movements

Carried Forward Position

Trading Position

Discrepancies transferred to/resolved from local suspense

qa) 7 m Oo} ao

Adjustments to local suspense

Total branch adjustments to local suspense

The Trading Position should always be zero. A non-zero trading position value in any
column indicates a software or reference data fault (e.g. incorrect equations in
BTSSourceData, incorrect product PM / SM / TM mappings, incorrect EPOSSNodes, or
internal software fault in accounting logic).

Appendix 7.0 explains what each figure in the BTS summary section means in business terms
(and makes comparisons to the Cash Account).

4.7.6.3.1.2 Stock Holdings Section

The Stock Holdings section reports the quantities of Volume Stock held by the branch (i.e.
the sum of quantities held by all stock units). This is defined by BTSSourceData section
object LineX.

This is followed by the number of transaction corrections applied during the TP (defined by
objects starting LineY) and the declaration (defined by objects starting LineZ).

Below is an example BTS Stock Holdings Section.

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 47 of 92
FUJ00091192

FUJ00091192
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005
serenade rap easiaes rage 2
sess gaysnseoos trast Branch Trading fracemenn - Office Copy From 28/21/2005 To 29/11/2005 we

Bs
ie
abe
ee
S08

T contity chat che content of this batuncing and erading statemint 4s an accurate reflection of the cash and stock on hand at ehis branch

see mmm ox vEFORY ve*

47.63.13 Diagnosing Incorrect BTS Values
To identify why a figure is wrong on the BTS:

e Check the BTSSourceData equations used to create the figure and verify they are correct.

e Check the BTS values written on Stock Unit rollover and verify they have been correctly
used by the print method and printed on the BTS. The figures read by the BTS from the
Stock Unit trailer are printed in the Audit log. See also section 4.3 for details of the Stock
Unit BTS rollover trailers and a tool for looking at them.

© Check the BTS values written by the Stock Unit rollover have been correctly calculated
by EPOSSStockUnit using the BTSSourceData source method equation. This will
involve identifying the transactions and/or opening figures that contribute to a given
accounting node or product, and checking the summation is correct. Comparison can be
made to the Stock Unit Final Balance Reports (which can be reprinted if necessary) and
the Office Snapshot.

It is vital to understand the difference between the three types of Stock Unit BTS trailer,
when they are written and what they are used for. See [EP/LLD/011] for detail, but in
summary the BTS trailers are:

BTSCFFiguresTrailer Written on stock unit rollover and holds values for BTS
lines starting C, D, E, G, H, Y.
PreBTSBFFTrailer Written on stock unit rollover. Not directly used by the

BTS, but are used to produce the

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 48 of 92
FU.

FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

CurrentBTSBFFiguresTrailer on the next stock unit
rollover.

CurrentBTSBFFiguresTrailer Written on stock unit rollover as a copy of the values
from the previous rollover’s PreBTSBFFTrailer. Holds
values for BTS lines starting B (i.e. Brought Forward
Figures), excluding Lines BBB and BBBB which are
held in the office rollover CurrentBTSBFFiguresTrailer.

The last year’s worth of Final BTS prints are held in BLOB objects in ref data collection
Reprints, and the last BTS can be reprinted from the Reprints menu. The other historic BTS
BLOBs could be reprinted by changing the Reprints object being accessed in
BESReports.clsBESReports.GenReprintReport via the debugger.

An Excel spreadsheet version of the BTS (linked to the Trial and Final Stock Unit Balance
report, and the Suspense Account report) is available.

4.7.6.3.2. Suspense Account Report
This report is handled by BESReports.

This report is now soft configured via reference data collection SuspenseSections. Each
section defines the section title and which suspense products should be reported in that
section.

If transactions are not appearing on the Suspense Account report it may be that the
SuspenseSections has not been updated with the correct products.

Brought forward figures are read from the ## figures written by the office CAP or TP
rollover. Suspense movements are read from transactions that have occurred while stock
units were in the current CAP or TP. Both brought forward and movement transactions are
filtered for primary mapping L2 = 490 or 740.

The various Suspense section totals combined to form the net suspense figure that appears on
the Branch Trading Statement. The printed sense (positive/negative) of section values is
changed depending on the section so that they are all normally printed positive. However,
when summing to derive the net suspense figure the transaction sense is used. Sections with
products mapping to node 740 represent Unclaimed Payments (a loss to the branch), whereas
sections with products mapping to node 490 represent Uncharged Receipts (a gain to the
branch).

See [EP/LLD/011] for details.

4.7.6.3.3, Stock Unit Balance Reports

These reports are handled by GlobalObjects. The SU Balance Snapshot is a different physical
report from the SU Trial Balance and SU Final Balance Report. New versions of both these
reports were introduced at S80 to allow for the different layouts caused by the introduction of
‘Stock by Volume’.

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 49 of 92

FUJ00091192
IJ00091192
FUJ00091192

FUJ00091192
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

48 Message Retention

4.8.1 Purpose

A message written to the message store can include an expiry attribute that defines the
number of days after which the message expires. Expired messages are archived and deleted
from the message store.

Riposte defines a default expiry value for messages that do not explicitly define an expiry
value, and a minimum and maximum value that override any explicitly defined values.

The purpose of the change is to:
e Increase the expiry value of messages that need to be retained for a trading period.

e Decrease the expiry value of other messages where sensible so that message store size is
minimised.

4.8.2 High Level Design
The high level design is given in [EA/HLD/005] section 5.1.1.

4.8.3 Low Level Design

The low level design in given in [EA/LLD/003].
The following components are impacted:
e BESReports

e EPOSSCommon

e EPOSSCore

e¢ EPOSSDataServer

« EPOSSDeclare

« EPOSSMessage

e EPOSSReportBroker

e EPOSSReportProcessor

e EPOSSSettlement

« EPOSSStockUnit

e EPOSSWatchDog

e LFSConfirm

e NBFinalise

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 50 of 92
FUJ00091192

FUJ00091192
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

* OBCS
e  TestPeripherals

The components typically use modCachedData.bas to read TxnExpiry and MinAppExpiry at
load time from ref data collection CounterConfigParam in to global variables. The global
variables are then used when writing transaction messages (which use TxnExpiry) and other
messages (which typically use MinAppExpiry). Some transient messages use a hard-coded
value of 1.

4.8.4 Message Store Messages

See [EA/LLD/009] for details as to which messages are impacted.

4.8.5 Reference Data

Collection CounterConfigParams object Counter contains the attributes:

Attribute Name I Value

TxnExpiry 42
MinAppExpiry 20

Although the design permits different values for different components via component specific
objects, this is not currently used, and should not be used until PEAK PC0117648 is fixed.

4.8.6 Troubleshooting

4.8.6.1 Diagnostics Written

No explicit diagnostics are written.

4.8.6.2 Tools

No explicit tools are available — the standard Riposte tools for examining messages should be
used.

48.6.3 Fault diagnosis

If messages are not being written with the correct expiry values:

e Check the expiry value on the message by examining the expiry attribute (e.g.
<Expiry:42>).

e Check the correct value for the message type (see [EA/LLD/003]). Not all messages have
been changed at S80 Impact Release 3.

e Check the following Riposte configuration values on the counter (via RiposteConfig get
<Name>), which can override the value specified by the code.

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 51 of 92
2 $80 Imp . ationa
pact Release 3 EPOSS Counter Operational
FU ITSU Support Guide
FUJITSU SERVICES

COMPANY-in-CONFIDENCE

FUJ00091192
FUJ00091192

Ref: EP/SPG/001

Version: 1.0
Date: 20/05/2005

Name Value
MinMessageExpiry 34
MaxMessageExpiry 50
DefaultMessageExpiry 43
MaxReanimation 49

© Check the expiry values in CounterConfigParams object Counter (see section 4.8.5

above).

© Identify the code writing the message and ensure it is using the correct value.

©Copyright Fujitsu Services Ltd 2005

COMPANY-in-CONFIDENCE

Page: 52 of 92
FU.
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

49 Maintain Office Variances

4.9.1 Purpose

This purpose of Maintain Office Variances is to analyse transactions that have occurred
during the day and create / maintain the Variance History persistent objects.

These objects were used by the now defunct Cash Variances report, and thus strictly speaking
there is no need for this functionality. It has not been removed in order to i) avoid the risk
associated with a late change when most of the validation has happened and ii) be present in
case POL wish to re-instate the report.

4.9.2 High Level Design
The high level design is given in [EA/HLD/006] section 4.1.8 and 4.6.3.

Since this is an end of day process, there is no user interface.

4.9.3 Low Level Design
The low level design is given in [EA/LLD/007].

The design is implemented in component CASEPOSSImpact.exe (for historic reasons — one
would expect it to be called MaintainOfficeVariances.exe). This component is executed by
the Counter Application Scheduler as part of the EOD Service.

The LLD refers to the Data Protection check being part of this component. This is no longer
true as the Data Protection check has been moved to the separate DataProtection component
(see section 4.10 below).

4.9.4 Message Store Messages
CASEPOSSImpact writes warning messages and fatal error messages to the message store
(see section 4.9.6.1 below).

4.9.5 Reference Data

The variance history objects are used/updated. These are defined in [EA/HLD/006] section
4.10.3. They are held in reference data collection Variance_ww where ww is the variance
week number.

Riposte Queries are used that are defined in collection EPOSSStockUnit, object
OfficeVariances. See [EA/HLD/006] for details.

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 53 of 92

FUJ00091192
IJ00091192
FUJ00091192

FUJ00091192
FUNITSU $80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

4.9.6 Troubleshooting

4.9.6.1 Diagnostics Written
Fatal errors are written to the Windows Event log (see section 5.1).
CASEPOSSImpact supports Tunable Tracing, if required. See [EA/LLD/007] for details.

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 54 of 92
FUJITSU

FUJITSU SERVICES

Support Guide

S80 Impact Release 3 EPOSS Counter Operational

COMPANY-in-CONFIDENCE

Ref: EP/SPG/001
Version: 1.0
Date: 20/05/2005

FUJ00091192
FUJ00091192

CASEPOSSImpact writes warning messages and fatal error messages to the message store.

These have attribute <Application:CASEPOSSImpact>. It

does not write “informational” messages (for example to log when it started or finished). See [EA/LLD/007] for the message format.

The following table shows the message text (included here since not in LLD):

Reason Type Code Literal Text Comment
Number
1 Fatal MN_UNUSED Message id not found in VB Resource File.
101 Warning MN_MORE_THAN_ONE_INSTANCE I More than one instance of this DLL have been initialised. More than one instance of the project has
been started.
Not written as a message — raised as
Windows warning event
102 Fatal MN_FAILURE_TO_SET The data <Data> cannot have the attribute <4“tName> with I Used when there has been a failure setting
value <Value> set in it. an attribute.
103 Fatal MN_ILLEGAL_ATTRIBUTE_VALUE I The <4iName> attribute of the <Data> data has the value I Used when the returned attribute value is
<Value> - this is illegal. illegal.
104 Fatal MN_ILLEGAL_ENUMERATED TYP I The enumerated type <Zype> has been passed in the value I Used when the value of an enumerated
E_VALUE <Value> which is illegal. type is not one of its allowed values.
105 Fatal MN_ILLEGAL_WEEK_NUMBER The week number is <WeekNo> - it should be between I and 53. I Used when a week number supplied is
illegal.
106 Warning I MN_ILLEGAL_VARIANCE_OBJECT I The object name <Name> does not analyse as expected. The supplied object name can not be
_NAME properly analysed as a collection
Variance _ object.
107 Fatal MN_CANNOT_FIND_OBJECT The object <ObjName> cannot be found from the collection I The persistent object cannot be found.
<Collection> for reason <Reason>.

©Copyright Fujitsu Services Ltd 2005

COMPANY-in-CONFIDENCE

Page: 55 of 92

FUJ00091192
FUJ00091192

FUJITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0

FUNTSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

108 Fatal MN_DUPLICATE_OFFICE Duplicate Office object found whose data is <Data>. Message produced when a duplicate Office
object is found which should be
impossible.

109 Fatal MN_NO_END_OF_DAY_AT_ALL. No End of Day marker has been found at all! No End Of Day marker has been found at
all. This should be impossible since this
program is only run if the End Of Day
process has run correctly. However it does
occur in the very rare case that it is the first
day the program has ever run on a new
counter and you have disconnected
counters since in that case the EOD Marker
program runs and produces no Marker;
then CASEPOSSImpact runs — and
incorrectly complains no marker can be
found.

110 Fatal MN_ILLEGAL_VALUE_RETURNED I The value <Value> was returned whereas only <Value/> or I Illegal value returned.

_FROM_TWO_POSSIBLE <Value2> should be returned.
Tl Faial MN_UNEXPECTED_STRING_STAR I The string must start <7ex’> whereas it actually started <Tex’>. I Unexpected string start.
T

m2 Fatal MN_NOT_DAY_START Unrecognised day prefix returned. The data was not one of Decl Mon,
Decl_Tue ete and could not be converted.

113 Fatal MN_QUERY_STATUS_UNEXPECTE I The query completed with a status of <Status>! Waiting for the query produced an

D unexpected result.

114 Fatal MN_INVALID_ PROCESS KEY The counter application has failed because the Process Key from I An invalid key has been received from the

the calling process is invalid. application scheduler.

115 Fatal MN_INTEGRITY_CHECK_FAILED The scheduler integrity check has failed. The scheduler failed its integrity check

116 Fatal MN_TIMEOUT_EXTENDED It has been necessary to extend the timeout period at point I Warning produced when the timeout

©Copyright Fujitsu Services Ltd 2005

COMPANY-in-CONFIDENCE

Page: 56 of 92

FUJ00091192

FUJ00091192
FUJITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUITTSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005
<Point>. period is extended
117 Fatal MN_TIMEOUT_NOT_EXTENDED Failure to extend the timeout period at point <Point> Failure to extend timeout period
118 Fatal MN_UNKNOWN_COMMAND Unknown command <Command> received. Unknown command received.
119 Fatal MN_NO_ROLLOVER_BEFORE_MA_ I No Office Rollover Trailer found before the mark <Mark>. No Office Rollover trailer found before the
RK supplied marker.
120 Fatal MN_NO_OFFICE_OPENING FIGUR I No Opening figures found in Office Rollover Trailer before mark I No opening figures in Office Rollover
ES_FOUND <Mark>. trailer
121 Fatal MN_NO_MARKER_IN_OFFICE_OPE I No marker found in Office Rollover Trailer before mark <Mark>. I No marker found in Office Rollover trailer
NING_FIGURES_FOUND
122 Fatal MN_VARYING_OFFICE ROLLOVE I The message Id of Office Rollover messages varies - this is not I Defensive message when the id of Office
RID allowed. Rollover messages vary

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 57 of 92
FUJ00091192

FUJ00091192
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

4.9.6.2 Tools

The variance week number is in the range 1 through 53. It starts at 1 for the week
commencing the first Thursday of the calendar year. It can be calculated for any given date
using the VarDate.exe test tool. See [EP/LLD/011] section 14.3.3.9 regarding the Cash
Variances Report diagnostics for details.

4.9.6.3 Fault diagnosis
A typical approach to troubleshooting involves:

e Check the Windows Event log for error messages. One “red” event log error with source
CASEPOSSImpact is written if one or more fatal error messages have been written to the
message store.

© Check the message store for warning or fatal error messages (as mentioned in section
4.9.6.1 above).

e Check the contents of the Variance History objects that are updated by
CASEPOSSImpact using an object viewer (e.g. Object Editor2.exe). The variance week
number is in the range I through 53. It starts at 1 for the week commencing the first
Thursday of the calendar year. It can be calculated for any given date using the
VarDate.exe test tool. See [EP/LLD/011] section 14.3.3.9 regarding the Cash Variances
Report diagnostics for details.

The contents of the Variance History objects could also be viewed indirectly via the Cash
Variances Report, except that as stated previously this report is no longer used.

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 58 of 92
FU.
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

4.10 Data Protection

4.10.1. Purpose

The purpose of this Data Protection is to avoid Riposte messages from being archived (and
hence deleted) in the case where they have exceeded their expiry date, but are still needed
(this typically means stock unit EPOSS transactions and related accounting messages that
need to be kept until the end of a Trading Period for accounting purposes).

EOD Service logic runs to disable Risposte archiving, if necessary. This DataProtection
component is scheduled to run overnight via the Windows NT scheduler (“at” job) at 3:15
a.m., unlike other EOD tasks which are run by the Counter Application Scheduler at 3:30
a.m. (+/- 5 minutes).

In-Day Service logic runs at logon to warn the user that the office should be rolled over, if
necessary. This logic is described here, although it is part of the In-Day service not the EOD
Service.

4.10.2 High Level Design

The EOD high level design is given in [EA/HLD/006] section 4.6.5 and 4.7, and
[EA/HLD/005].

The In Day high level design is given in [EA/HLD/006] section 4.7.1.

4.10.3. Low Level Design
The low level design is given in [EA/LLD/019].

During the End Of Day Service, a check is made. The number of days that have past since
the earliest stock unit rolled into the current office CAP/TP is compared with collection
CounterConfigParams object Counter attribute RollExpiry (currently 38 days). If the number
of elapsed days is great than this, an NT event log error is raised and Riposte archiving is
disabled (otherwise Riposte archiving is enabled). This is implemented in component
DataProtection.exe.

A further check is made on logon. The number of days that have past since the earliest stock
unit rolled into the current office CAP/TP is compared with collection CounterConfigParams
object Counter attribute WarnLogonRolloverDays (currently 37 days). If the number of
elapsed days is great than this, a warning is presented to the user asking them to rollover the
office. This is implemented in component EPOSSStockUnit. The logon warning text is:

Warning

It is [Days Since Rollover] days since stock unit [Stock Unit Name] was rolled into the
current branch trading period. Please roll the branch into a new period as soon as
possible to avoid risk of losing data.

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 59 of 92

FUJ00091192
IJ00091192
FUJ00091192

FUJ00091192
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

4.10.4 Message Store Messages

The EOD Service writes DataProtection error and warming messages the message store.
These have attribute <Application:DataProtection>. It does not write “informational”
messages (for example to log when it started or finished). See [EA/LLD/019] for details.
4.10.5 Reference Data

Collection CounterConfigParams object Counter attributes RollExpiry and
WarnLogonRolloverDays (see section 4.10.3 above).

4.10.6 Troubleshooting

4.10.6.1 Diagnostics Written
Fatal errors are written to the Windows Event log (see section 5.1).

4.10.6.2 Tools

Whether or not the archiver is disabled can be found via command “tiposteconfig get
DisableArchiving”:

C:\counters\bin>riposteconfig get DisableArchiving
DisableArchiving = 0
C:\counters\bin>

Any change to this value will not be displayed until the Riposte service has been restarted -
for example by the overnight process Cleardesk.

The last run time can be found via command “ripostearchive info”:
C:\counters\bin >ripostearchive info
Archive in progress = 0
Archive completed = 1
Last end date/time = 2005-04-25 10:06:28
C:\counters\bin >

Riposte archiving can be forced to run by executing “c:\counters\bin\ripostearchive start”.

4.10.6.3 Fault diagnosis

© Check the Windows Event log for error messages. One “red” event log error with source
DataProtection is written if one or more fatal error messages have been written to the
message store.

The archiver disabled message is “Office Rollover is Overdue - Archiver has been
disabled”. This is raised each day (at 3:15 am when DataProtection.exe is run) until the
check passes successfully.

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 60 of 92
FUJ00091192

FUJ00091192
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-in-CONFIDENCE Date: 20/05/2005

© Check the message store for DataProtection error or warning messages (as mentioned in
section 4.10.4 above).

e Check the value of RollExpiry in collection CounterConfigParams object Counter has the
correct value (38 days at the time of writing). Archiving could be disabled on the next
run of DataProtection.exe by setting this value to —1, but must be reset to the original
value once problems are resolved.

e Check the current state of Risposte archiving (see section 4.10.6.2 above).

e DataProtection.exe on single counter offices (SCOs) disables archiving on the
RiposteMirror service and well as the main Riposte service.

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 61 of 92
FUJITSU

FUJITSU SERVICES

$80 Impact Release 3 EPOSS Counter Operational

Support Guide
COMPANY-In-CONFIDENCE

Ref: EP/SPG/001

Version: 1.0

Date: 20/05/2005

FUJ00091192
FUJ00091192

5.0 Errors

Unless otherwise specified, Tuneable Trace is not used by EPOSS components.

5.1 Windows Event Log

This section lists all event log messages for EPOSS components that have changed for S80 Impact Release 3.

Source Application Event Message Type ISupport Notes
ICASEEPOSSImpact Problem in Main - <VBErrDescription> Error IVB runtime error in modMain.Main
ICASEEPOSSImpact VB failure in psModuleName Error /VB runtime error in clsErrorHandling.psModuleName reported via
fSimpleError. The passed module name failed to be assigned to the error
handling object.
ICASEEPOSSImpact VB failure in fsDoASubstitute Error {VB runtime error in clsErrorHandling. fSDoASubstitute reported via
fSimpleError. Substitution failed.
ICASEPOSSImpact Failure to write trace message - <msg> Error IVBTrace returned False in clsErrorHandling. fTrace
ICASEEPOSSImpact Problem in f{TraceAndErrorInit - Error I VB runtime error in modTraceAndDiagnostics.fTraceAndErrorInit.
<VBErrDescription>
ICASEEPOSSImpact Failure to write trace version Error Called from modTraceAndDiagnostics. fWriteVersionInformation. Tuneable
(Trace call VBTrace returned false.
ICASEEPOSSImpact ‘CASEPOSSImpact has failed - see the message Error ICalled from modTraceAndDiagnostics. fLogAtMostOneRedEvent. This is
store for more detailed error messages! an important error as it means that CASEPOSSImpact has stopped working.
ICASEPOSSEvProducts Unable to initialise scheduler object Error {Called from Load event of form frmEOD. Happens if the function

funMain=false.

©Copyright Fujitsu Services Ltd 2005

COMPANY-in-CONFIDENCE

Page: 62 of 92
FUJITSU

$80 Impact Release 3 EPOSS Counter Operational

R

EP/SPG/001

FUJ00091192
FUJ00091192

Support Guide Version: 1.0

FUNTSU SERVICES COMPANY-In-CONFIDENCE Date: 20/05/2005

Source Application Event Message Type ISupport Notes

ICASEPOSSEvProducts Error No : <ErrNo>, Error Description : Error {Called from Load event of form frmEOD. Used in general event error

<ErrMessage> handler.

ICASEPOSSEvProducts A Counter Application Scheduled task could not) Warning ICalled from funMain in modMain. Happens if the identifier key passed by

been started due to missing environmental the scheduler is an empty string.
parameters

DataProtection VB failure in fLogMessage - <LogMessage> Error IVB runtime error in clsErrorHandling, f[LogMessage reported via
fSimpleError.

DataProtection VB failure in psModuleName Error {VB runtime error in clsErrorHandling.psModuleName reported via
fSimpleError. The passed module name failed to be assigned to the error
handling object.

DataProtection VB failure in fsDoASubstitute Error I VB runtime error in clsErrorHandling. fsDoASubstitute reported via
fSimpleError. Substitution failed.

DataProtection 'VB failure in fsDoASubstitute Error I VB runtime error in clsErrorHandling. fsDoASubstitute reported via
fSimpleError. Substitution failed.

DataProtection Problem in Main - </BErrDescription> Error I VB runtime error in modDataProtection.Main

DataProtection Office Rollover is Overdue - Archiver has been Error {Called from modDataProtection.fSetRiposteArchiverStatus. Riposte

disabled archiving disabled since office rollover is overdue.

DataProtection Problem in fTraceAndErrorInit - Error I VB runtime error in modTraceAndDiagnostics. ffraceAndErrorInit.

<VBErrDescription>

DataProtection Failure to write trace version Error {Called from modTraceAndDiagnostics. fWriteVersionInformation. Tuneable:
[Trace call VBTrace returned false.

/DataProtection DataProtection has failed - see the message store) Error [Called from modTraceAndDiagnostics. fLogAtMostOneRedEvent. This is

for more detailed error messages!

lan important error as it means that DataProtection has stopped working.

©Copyright Fujitsu Services Ltd 2005

COMPANY-in-CONFIDENCE

Page: 63 of 92
FUJITSU

$80 Impact Release 3 EPOSS Counter Operational

Ref: EP/SPG/001

FUJ00091192
FUJ00091192

Support Guide Version: 1.0
FUNTSU SERVICES COMPANY-In-CONFIDENCE Date: 20/05/2005
Source Application Event Message Type ISupport Notes
/EPOSSCommon Unexpected error in Main. Error: <HexErrNo> Error I VB runtime error caught in top level error handler in modMain.Main.
<ErrDescription>
/EPOSSCommon ‘StockUnitBPMarker object overflow Error —ICalled from clsStockUnitBPMarkers. foWriteSUBP Marker if the
<NewBPMarkersObjectName> fsPutPersistentObject call fails.
/EPOSSAppMain Mode inconsistencies detected on Stack. Error ICalled from modEPOSSHelpers.bCheckStackModeConsistent.
/EPOSSAppMain <ErrorMsg> was returned trying to read Error __IError returned from GetPersistentObject in clsEPOSS. Initialize.
(aka EPOSSCore) EPOSSStockUnit Parameters
/EPOSSAppMain <ErrorMsg> was returned trying to read Error —_IError returned from GetPersistentObject in clsEPOSS Initialize.
(aka EPOSSCore) EPOSSCore ApplicationNames.
EPOSSAppMain ‘Unexpected error in Main. Error: <HexErrNo>I Error —ICalled from Initialize in EPOSS class. Used in general procedure error
(aka EPOSSCore) <ErrMessage> handler.
/EPOSSAppMain Possible index corruption suffered on search Error {Called from clsEPOSS.ProcessReversalReferenceEntered if transaction not
(aka EPOSSCore) for Exisiting Reversal <Reference> found.
EPOSSAppMain Unable to BEGIN transaction. <ResultE-rror> Error {Called from ProcessStockTransferTransactions in EPOSS class. Happens
(aka EPOSSCore) lwhen an attempt to start a transaction does not return a successful result.
/EPOSSAppMain Unable to UNDO transaction. <ResultError> Error — ICalled from ProcessStockTransferTransactions in EPOSS class. Happens
(aka EPOSSCore) Iwhen an attempt to undo a transaction does not return a successful result.
/EPOSSAppMain Unable to END transaction. <ResultError> Error ICalled from ProcessStockTransferTransactions in EPOSS class. Happens
(aka EPOSSCore) Iwhen an attempt to end a transaction does not return a successful result.

©Copyright Fujitsu Services Ltd 2005

COMPANY-in-CONFIDENCE

Page: 64 of 92
FUJITSU

$80 Impact Release 3 EPOSS Counter Operational

Ref: EP/SPG/001

FUJ00091192
FUJ00091192

Support Guide Version: 1.0
FUNTSU SERVICES COMPANY-In-CONFIDENCE Date: 20/05/2005
Source Application Event Message Type ISupport Notes
/EPOSSAppMain Internally generated error in CallInterface Warning ICalled from clsEPOSS.CallInterface. An error has already been logged at a
(aka EPOSSCore) <ErrDescription> Command was <Command> lower level.
/EPOSSAppMain ProductGroup processing performance. Elapsed Info ICalled from clsEPOSS.fReCreateProductGroups to summarise function
aks Time:<time> seconds. (New) ProductGroup results.
(aka EPOSSCore) objects written to MsgStore:<Num Written>
(Redundant) ProductGroup objects deleted from
/MsgStore:<NumDeleted>
IEPOSSAppMain RP is 0 but MV is not for <ProductNo>! Info Called from clsProduct.Initialize. RetailPrice is zero but Multiple Value is
(aka EPOSSCore) not - for the named product.
IEPOSSAppMain MV not multiple of RP for <ProductNo>! Info ICalled from clsProduct.Initialize. Multiple Value is not a multiple of the
(aka EPOSSCore) Retail Price - for the named product.
EPOSSAppMain Product Data for EPOSSProduct Info {Called from clsProduct.ValidQty. Indicates that an invalid quantity is being
(aka EPOSSCore) [<ProductNo>] state a Min Quantity of attempted to be transacted. Note:The value of MaxQty is currently
aka ore [<MinQty>] and a Max Quantity of incorrectly being logged as the value of MinQty.
[<MaxOty>]. An attempt is being made here to
transact a quantity of <Qty>.
/EPOSSAppMain Class initialisation completed Info {Called from Initialise in EPOSS class.
(aka EPOSSCore)
IEPOSSDataServer Unexpected method call clsSession.Notify Error IThe .Notify method was called in class Session
received
IEPOSSDataServer Unexpected method call Error IThe .CallInterface method was called in class Session
clsSession.CallInterface received
EPOSSDataServer Error in node retrieval for node(s) <Nodes> Error _ Called by modDesktopHelpers. LogNodeError to log node errors.

©Copyright Fujitsu Services Ltd 2005

COMPANY-in-CONFIDENCE

Page: 65 of 92
FUJITSU

$80 Impact Release 3 EPOSS Counter Operational

R

EP/SPG/001

FUJ00091192
FUJ00091192

Support Guide Version: 1.0
FUNTSU SERVICES COMPANY-In-CONFIDENCE Date: 20/05/2005
Source Application Event Message Type ISupport Notes
IEPOSSDataServer Invalid additional criteria. VarType is Error {Called from Function CompareToAdditionalCriteria in class InternalSession.
<VarType> IAn additional criteria was not of type String
IEPOSSDataServer Invalid comparison operator in additional Error —ICalled from Function CompareToAdditionalCriteria in class InternalSession.
Comparison operator is <Operator>. The comparison operator of an additional criteria was not in ['EQ','eq' or
Criteria is <Criteria>. "'DEQ'I.
IEPOSSDataServer Error in DestroyMessagePort: < ResultError> Error IA RIPOSTE function. Called from CompletePopulateTree in class
InternalSession.
IAlso called from clsInternalSession.Reset.
IEPOSSDataServer Error in DeleteQuery: < ResultError> Error {A RIPOSTE function. Called from CompletePopulateTree or
TidyUpA fterCompletePopulateTree in class InternalSession
IAlso called from clsInternalSession.TidyUpA fierCompletePopulateTree
IEPOSSDataServer Error in CreateMessagePort: <ResultError> Error IA RIPOSTE function. Called from CompletePopulateTree in class
InternalSession.
IEPOSSDataServer Abort retrieval of record after 5 attempts, record II Error —_ICalled by clsInternalSession.CompletePopulateTree if
reference = <CurrentRecord> ResultSuccessForRecordRetrieval returns false > 5 times.
/EPOSSDataServer Aligment errors have occurred - see audit log Error {Called from clsInternalSession.LogAlignmentErrors.
for details.
IEPOSSDataServer [<DesktopCurrentApp>I Error in Warning ICalled from CompletePopulateTree in class InternalSession.
CreateQuery(<Criteria>) <ResultError>
EPOSSDataServer [<DesktopCurrentApp>I Error in Waring [Called from CompletePopulateTree in class InternalSession.
QueryStatus(<Criteria>) <ResultError>
IEPOSSDeclare Unexpected error in Main. Error: Error {Called from sub Main in modMain. Used in procedure error handler and

[0x<HexErrNo>I <ErrMessage>

probably caused when EventLogOpen fails.

©Copyright Fujitsu Services Ltd 2005

COMPANY-in-CONFIDENCE

Page: 66 of 92
FUJITSU

$80 Impact Release 3 EPOSS Counter Operational

R

EP/SPG/001

FUJ00091192
FUJ00091192

Support Guide Version: 1.0
FUNTSU SERVICES COMPANY-In-CONFIDENCE Date: 20/05/2005
Source Application Event Message Type ISupport Notes
EPOSSDeclare Unexpected error in fProcessAdjustment. Error: Error {Called from clsVariances. {Process Adjustment. Used in procedure error
[0x<HexErrNo>] <ErrMessage> handler.
/EPOSSDeclare <message> - returned from EPOSSCore. Error —_ICalled from clsVariances.foWriteEPOSSTransaction if response from
EPOSSCore transaction is not successful.
EPOSSDeclare <message> - producing message grammar. Error {Called from clsVariances.foWriteEPOSSTransaction if response from
fsCreateFormattedMessageld is not successful.
/EPOSSDeclare Unable to get unique identifier for Error {Called from CommitList in EPOSSDeclare class. Happens when a call to
DrawerltemDeclarationld. Error: <ResultError> \GetUniquelD does not return a successful result.
/EPOSSDeclare ‘Unable to create drawer item declaration detail. Error {Called from CommitList in EPOSSDeclare class. Happens when calls to
Error: <ResultError> CreateDrawerltemDeclarationDetail, CreateDrawerltemDeclaration or
CreateONCHDeclaration do not return a successful result.
EPOSSDeclare Unable to create drawer item declaration. Error: Error {Called from CommitList in EPOSSDeclare class. Happens when calls to
<ResultError> CreateDrawerltemDeclaration does not return a successful result.
/EPOSSDeclare Error connecting to OLE Server <ClassName>. Error {Called from general procedure error handler in clsEPOSSDeclare. Initialize
[0x<HexErrNo>] ; <ErrMessage> lor clsEPOSSDeclare.Connect.
EPOSSDeclare Error committing declarations. Error: Error — ICalled from HandleCmdStr in EPOSSDeclare class. Happens when a call to
<ResultError> CommitList does not return a successful result.
IEPOSSDeclare DrawerltemDeclaration entry not found. Error Error — {Called from NextDrawerltemDeclaration in EPOSSDeclare class. Happens
<ResultError> lwhen an attempt to get an entry does not return a successful result.
EPOSSDeclare Error in Transacting ProcessAdjustments :- Error Called from clsEPOSSDeclare.ProcessAdjustments if the call to EPOSSCoreI
(<Command>) ‘is not successful.
/EPOSSDeclare Unable to get current marker. Error: Error Called from GetGetDrawerltemDeclarations in EPOSSDeclare class.

<ResultError>

Happens when an attempt to get a marker does not return a successful result.

©Copyright Fujitsu Services Ltd 2005

COMPANY-in-CONFIDENCE

Page: 67 of 92
FUJITSU

$80 Impact Release 3 EPOSS Counter Operational

Ref: EP/SPG/001

FUJ00091192
FUJ00091192

Support Guide Version: 1.0

FUNTSU SERVICES COMPANY-In-CONFIDENCE Date: 20/05/2005

Source Application Event Message Type ISupport Notes

EPOSSDeclare ‘Unexpected error executing fsCalculateRate - Warning ICalled from general procedure error handler in
see audit log for details. lclsEPOSSDeclare. fsCalculateRate.

/EPOSSDeclare Unexpected error executing fCacheSpotRates - I Warning ICalled from general procedure error handler in
see audit log for details. \clsEPOSSDeclare.fsCacheSpotRates.

EPOSSDeclare Warning: An attempt was made to invoke a Warning ICalled from CallInterface from EPOSSDeclare class. Happens when the flag
public interface before the application has been fAppStarted=false.
initialised.

IEPOSSMessage EPOSSMessage.LogStandardEvent() failed. Warning ICalled from clsEvent.LogStandardEvent if LoadStandardEvent returned
Failed to find Persistent Obje false.
[Collection:Events].[Object:<EventID>I

IEPOSSMessage EPOSSMessage. foLogStandardTransaction() Warning ICalled from clsEvent.foLogStandardTransaction if RetailBroker write
failed. Call to RetailBroker.Transaction(1) message fails.
failed: " RetailBroker returned the following
message: <ErrMessage>.

IEPOSSMessage EPOSSMessage.LogSystemEvent() failed. Warning ICalled from clsEvent.LogSystemEvent if foLoadSystemEvent returned false.
Failed to find Persistent Object:
[Collection:Events].[Object:<EventID> I.

IEPOSSMessage EPOSSMessage. fbLogSystemTransaction() Warning {Called from clsEvent.fbLogSystemTransaction if RetailBroker write
failed. Call to RetailBroker.Transaction(2) Imessage fails.
failed: " RetailBroker returned the following
message: <ErrMessage>.

IEPOSSReportBroker Unable to get connection status to node Error _ ICalled from CheckNeighboursConnected in forDesktop class. (Report
<NodelD> Broker object, not Report Processor)

EPOSSSettlement Unexpected error in Class Initialize. Error: Error ICalled from procedure error handler in clsEPOSSSet Initialize.

[0x<HexErrNo>] <ErrMessage>

©Copyright Fujitsu Services Ltd 2005

COMPANY-in-CONFIDENCE

Page: 68 of 92
FUJ00091192
FUJ00091192

FUJITSU 80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0

FUIITSU SERVICES COMPANY-In-CONFIDENCE Date: 20/05/2005

Source Application Event Message Type ISupport Notes

EPOSSSettlement Unable to autosettle a <mode> transaction. Info Called from clsEPOSSSet.ProcessFinish if obj Desktop.IsLockedLogout is
(True.

EPOSSStatus Invalid attribute. Function: CreateDataTree Error — ICalled from CreateDataTreeWithRolloverld, CreateNonInventoryFigures,

Collection: [Data.BalanceRootNode I StockUnitNonInventory, CreateDataTreeWithRolloverldForCashAccount

Data.StockRootNode] ObjectName: land CreateaSpecialTree in CurrentFigures class. Happens if the vars

<ObjName> Argument:<Arg> IBalanceRootNode or Istockrootnode = 0. The call to log this event message
never provides values for ObjName or Arg so these two are expected to be
always blank.

/EPOSSStatus Error creating data tree. PopulateTree failed. Error —ICalled from CreateDataTreeWithRolloverld, CreateaSpecialTree,
StockUnitNonInventory, CreateDataTreeWithRolloverldForCashAccount
land CreateNonInventoryFigures in CurrentFigures class. Happens when a
icall to the DataServer object to populate the tree returns false.

/EPOSSStatus Invalid attribute. Function: CreateDataTree Error — ICalled from CreateNonInventoryFigures in CurrentFigures class. Happens if

Collection: [Data.BalanceRootNode I the vars IBalanceRootNode or Istockrootnode = 0. The call to log this event
Data.StockRootNode] ObjectName: message never provides values for ObjName or Arg so these two are
<ObjName> Argument:<Arg> expected to be always blank.

/EPOSSStatus Unable to create object Error ICalled from Initialize in forDesktop class. Happens when the CreateObject

Desktop.dtpDesktopClass function returns nothing.

EPOSSStatus Unable to create object clsCurrentFigures Error {Called from Initialize in forDesktop class. Happens when the New method
returns nothing.

EPOSSStatus Error creating data tree. BuildTree failed. Error {Called from CreateDataTreeWithRolloverld, CreateaSpecialTree,
StockUnitNonInventory, CreateDataTreeWithRolloverldForCashAccount
land CreateNonInventoryFigures in CurrentFigures class.

EPOSSStockUnit Could not get Config Info for Cash Account ID Error ICalled from modDesktopHelpers.GetUniqueld if call to

= <dd/mm/yyyy hh:mm:ss>

(TALOP_GET_CONFIG_INFO fails three times.

©Copyright Fujitsu Services Ltd 2005

COMPANY-in-CONFIDENCE

Page: 69 of 92
FUJITSU

$80 Impact Release 3 EPOSS Counter Operational

R

EP/SPG/001

FUJ00091192
FUJ00091192

Support Guide Version: 1.0
FUIITSU SERVICES COMPANY-In-CONFIDENCE Date: 20/05/2005
Source Application Event Message Type ISupport Notes
/EPOSSStockUnit ‘Unexpected error in Error {Called from procedure error handler in
fsCurrentCAPRolloverMsgld. [0x</exErrNo>I modDesktopHelpers. fsCurrentCAPRolloverMseld.
: <ErrMessage>
/EPOSSStockUnit Error connecting to OLE Server <ClassName> Error I1.Called from BrokerHandle in modMain. Attempted to create a handle to an
lobject which returned nothing. 2. Called from Connect in forDesktop class.
IAttempted to get a Message object handle or the Messages Event object
handle.
EPOSSStockUnit Bureau Parameters not Found in collection Error — ICalled from clsOutlet Initialize if required Bureau data not found.
EPOSSStockunit/Parameters
EPOSSStockUnit Error connecting to OLE Server <ClassName>. Error {Called from Connect in forDesktop class. Used in procedure error handler.
[0x<HexErrNo>I : <ErrMessage>
/EPOSSStockUnit ‘Unexpected error in Main. Error: Error —ICalled from sub Main in modMain. Used in error handler and probably
[0x<HexErrNo>] <ErrMessage> Icaused when EventLogOpen fails.
/EPOSSStockUnit ‘StockUnit Rollover Error EPOSSProduct data Error ICalled from GetNonInventoryPMs in modDesktopHelpers
missing for Product No. <ProdNo> (Rolling.
<CurrentStockUnit> ftom CAP <CurrentCAP>
/EPOSSStockUnit (Unable to get current marker. Error: Error —ICalled from GetGetDrawerltemDeclarations in modDesktopHelpers and
<ResultError> IGetONCHDrawerltemDeclarations in class Outlet.
IEPOSSStockUnit Unexpected error in SetDeclarationTrailer. Error —ICalled from SetDeclarationTrailer in modDesktopHelpers Used in procedure
[0x<HexErrNo>I <ErrMessage> error handler.
EPOSSStockUnit Unexpected error executing command. Error {Called from modDesktopHelpers.bCheckResult if supplied result is not
<message> - see audit log for details. success and bLogErrorInEventLog=True.
/EPOSSStockUnit An error has occurred within Error — ICalled from procedure error handler in modDesktopHelpers.bIsNon Value.

modDeskTopHelpers. blsNonValue. Error No:
<ErrNo> Error Desc: <ErrDescription>

©Copyright Fujitsu Services Ltd 2005

COMPANY-in-CONFIDENCE

Page: 70 of 92
FUJITSU

$80 Impact Release 3 EPOSS Counter Operational

Ref: EP/SPG/001

FUJ00091192
FUJ00091192

Support Guide Version: 1.0

FUNTSU SERVICES COMPANY-In-CONFIDENCE Date: 20/05/2005

Source Application Event Message Type ISupport Notes
Source: <ErrSource>.

/EPOSSStockUnit (Unexpected error in Error {Called from procedure error handler in
fsSetBTSTrailers.[0x<HexErrNo>I modDesktopHelpers.fsSetBTSTrailers.
<ErrMessage>

EPOSSStockUnit StockUnit Persistent Object Failure, Commiting, Error ICalled from clsStockUnit.Commit if written persistent object cannot be read
SU <SUName> back.

/EPOSSStockUnit ERROR: 3 - Missing reference data - Opening Error ICalled from clsOutlet Initialize if required Weekday information cannot be
Periods::OfficeHours found.

IEPOSSStockUnit ERROR: 3 - Missing reference data - Error —ICalled from clsOutlet Initialize if required OutletDetails information cannot
Outlet::OutletDetails be found.

EPOSSStockUnit Unexpected error in clsOutlet.Class_Initialize - Error —ICalled from procedure error handler in EPOSSStockUnit Initialize.
<err.Description>

EPOSSStockUnit ‘Unexpected error in Error — ICalled from InitialiseNew in class Rollover. Used in procedure error
InitialiseNew.[0x<HexErrNo>] <ErrMessage> handler.

IEPOSSStockUnit Unexpected error in Rollover.[0x<HexErrNo>] Error {Called from Rollover in class Rollover. Used in procedure error handler.
<ErrMessage>

/EPOSSStockUnit ‘Unexpected error in Error —ICalled from SetRolloverTrailer in classes Rollover and Outlet. Used in
‘SetRolloverTrailer.[0x<HexErrNo>I procedure error handler.
<ErrMessage>

EPOSSStockUnit Unexpected error in Error ICalled from SetRevaluationTrailer in class Rollover. Used in procedure error]
‘SetRevaluationTrailer.[0x<HexErrNo>I handler.
<ErrMessage>

/EPOSSStockUnit ‘Unexpected error in Error — ICalled from SetOpeningFiguresTrailer in classes Rollover and Outlet. Used.

SetOpeningFiguresTrailer.[0x<HexErrNo>I

in procedure error handler.

©Copyright Fujitsu Services Ltd 2005

COMPANY-in-CONFIDENCE

Page: 71 of 92
FUJITSU

$80 Impact Release 3 EPOSS Counter Operational

Ref: EP/SPG/001

FUJ00091192
FUJ00091192

Support Guide Version: 1.0

FUNTSU SERVICES COMPANY-In-CONFIDENCE Date: 20/05/2005

Source Application Event Message Type ISupport Notes
<ErrMessage>

/EPOSSStockUnit Unexpected error in Error — ICalled from SetNonInventoryStockTrailer in class Rollover. Used in
‘SetNonInventoryStockTrailer.[0x</TexErrNo>I procedure error handler.
<ErrMessage>

/EPOSSStockUnit ‘StockUnitBPMarker collection overflow Error Called from clsRollover. UpdateSUBPMarkers if the StockUnitBPMarker
<ObjectName> icollection exceeds the Riposte max message size.

IEPOSSStockUnit Unknown error in UpdateSUBPMarkers Error — {Called from procedure error handler in clsRollover.UpdateSUBPMarkers.
<ErrDescription>

/EPOSSStockUnit ‘SU:clsRollover.fCreateBTSSummaryLines() Error {Called from procedure error handler in
[ERROR:<ErrNo>:<ErrDescription> I IclsRollover.fCreateBTSSummaryLines.

/EPOSSStockUnit There has been a problem carrying forward Error ICalled from procedure error handler in
declarations on inactive stock unit rollover - see \clsPreviousDeclarations. fUnexpectedError.
the audit log for today for details!"

IEPOSSStockUnit Unexpected error in Error ICalled from CheckStockUnitRolloverDatein class clsOutlet. Used in
CheckStockUnitRolloverDate.[0x<HexErrNo>] procedure error handler.
<ErrMessage>

EPOSSStockUnit Unexpected error in Error —ICalled from SetOpeningFiguresTrailer in class Rollover. Used in procedure
SetOpeningFiguresTrailer.[0x<HexErrNo> I error handler. Also called from SetNonInventoryStockTrailer (coding error
<ErrMessage> ‘is presumed)

/EPOSSStockUnit Unable to get connection status to node Error ICalled from CheckNeighboursConnected in class Outlet.
<NodeID>

IEPOSSStockUnit ‘Lost Cash Account ID - <CurrentDate&Time> Error — ICalled from CallInterface in Outlet class.

IEPOSSStockUnit Revaluation Error executing Error — ICalled from clsOutlet.fbProcessBureauTxns if Abs(RevaluedSV) > MxV

©Copyright Fujitsu Services Ltd 2005

COMPANY-in-CONFIDENCE

Page: 72 of 92
FUJITSU

$80 Impact Release 3 EPOSS Counter Operational

R

EP/SPG/001

FUJ00091192
FUJ00091192

Support Guide Version: 1.0
FUNTSU SERVICES COMPANY-In-CONFIDENCE Date: 20/05/2005
Source Application Event Message Type ISupport Notes
fbProcessBureauTxns - <ErrDescription>”
/EPOSSStockUnit Mode Error in foProcessBureauTxns - see audit Error {Called from clsOutlet.foProcessBureauTxns if CheckModesForProduct
log for details. returns False.
/EPOSSStockUnit Unexpected error, Cannot Rollover Default Error {Called from ProcessOfficeBalanceConfirmation in Outlet class. Happens if
StockUnit vars OfficeCAPRecord and sDEFSU are both equal to “”.
/EPOSSStockUnit Error creating balance declarations. Error: Error {Called from ProcessFinalBalance in Outlet class. Happens when a call to
<ResultError> CreateBalanceDeclarations does not return a successful result.
EPOSSStockUnit SU:ProcessFinalBalance - BDC Discrepancy Error [Called from clsOutlet.ProcessFinalBalance if Discrepancy Value > MxV
[Value too large to transact
:<DiscrepancyValue>
EPOSSStockUnit Error attempting to get Rate info. for Error — {Called from clsOutlet.ProcessFinalBalance if RateInfo is null.
discrepancy transaction : <message>
EPOSSStockUnit Error checking for discrepancies.Error: Error — ICalled from Discrepancies in Outlet class. Happens when a calls
<ResultError> INonStockDiscrepancies or StockDiscrepancies do not return a successful
result.
EPOSSStockUnit Unable to get current marker. Error: Error {Called from clsOutlet.OutstandingSummaries if TALOP_GET_MARKER
<ErrorMsg> icall fails.
EPOSSStockUnit No CAMappings retrieved(1) Error —ICalled from clsOutlet.ProcessNewCashAccount if no cash account mappings}
were retrieved.
EPOSSStockUnit INo CAMappings retrieved(2) Error {Called from clsOutlet.ProcessNewCashAccount if no cash account mappings}
lwere retrieved.
/EPOSSStockUnit No intermediate ## records returned Error —ICalled from clsOutlet.ProcessNewCashAccount if

EPOSSStatus.clsForDesktop
CreateDataTreeWithRolloverldForCashAccount does not return ## records.

©Copyright Fujitsu Services Ltd 2005

COMPANY-in-CONFIDENCE

Page: 73 of 92
FUJITSU

$80 Impact Release 3 EPOSS Counter Operational

Ref: EP/SPG/001

FUJ00091192
FUJ00091192

Support Guide Version: 1.0
FUIITSU SERVICES COMPANY-In-CONFIDENCE Date: 20/05/2005
Source Application Event Message Type ISupport Notes
EPOSSStockUnit Unable to get unique identifier for Error {Called from ProcessNewCashAccount in Outlet class. Happens when a call
<CashAccountFiguresId>.Error: <ResultError> to GetUniquelD does not return a successful result.
IEPOSSStockUnit SU:clsRollover. fCreateBTSSuspenseLines() Error {Called from procedure error handler in
[ERROR:<ErrNo>:<ErrDescription> I IclsOutlet.fsCreateBTSSuspenseL ines.
EPOSSStockUnit ‘Unexpected error in feProcessLocalSuspense: Error {Called from procedure error handler in clsOutlet.feProcessLocalSuspense.
<ErrDescription>
/EPOSSStockUnit INON INVENTORY PM'S Search Failure Warning ICalled from GetNonInventoryPMs in modDesktopHelpers.Happens when an.
TALOP_CREATE_QUERY_EX <Index> lattempt to create a query does not return a successful result.
IEPOSSStockUnit NON INVENTORY PM'S Warning ICalled from GetNonInventoryPMs in modDesktopHelpers.Happens when an
TALOP_QUERY_STATUS <strIndex> lattempt to get a query status does not return a successfull result.
EPOSSStockUnit Warning: An attempt was made to invoke a Warning ICalled from Callinterface and GetObjectHandle from forDesktop class.
public interface before the application has been Happens when the flag fAppStarted=false.
initialised.
/EPOSSStockUnit Mode RD Not permitted for Product Warning ICalled from clsStockFigure.CheckForDiscrepancy if
<ProductNo>, Stock will be eliminated via CheckModesForProduct(ProductNo, "RD") returns False.
discrepancy rather than through revaluation and
discrepancy
EPOSSStockUnit ‘Unexpected error executing Warning ICalled from procedure error handler in clsOutlet.foCurrencyDiscrepancies.
fbCurrencyDiscrepancies - see audit log for
details.
EPOSSStockUnit User <Username> Could not be logged on, due I Warning Called from clsOutlet.CallInterface in case “ContinueLogonA fterError”.
to critical reference data missing from
Messagestore
EPOSStockUnit ‘Unexpected error executing Warning ICaleld from procedure error handler in clsOutlet.foProcessBureauTxns.

©Copyright Fujitsu Services Ltd 2005

COMPANY-in-CONFIDENCE

Page: 74 of 92
FUJITSU

$80 Impact Release 3 EPOSS Counter Operational

Ref: EP/SPG/001

FUJ00091192
FUJ00091192

Support Guide Version: 1.0

FUNTSU SERVICES COMPANY-In-CONFIDENCE Date: 20/05/2005

Source Application Event Message Type ISupport Notes
fbProcessBureauTxns - see audit log for details.

/EPOSSStockUnit ERROR Double Stockunit Rollover prevented. I Warning ICalled from clsOutlet.RollStock.

/EPOSSStockUnit Stockunit <SUName> has been set to roll Warning ICalled from clsOutlet.RolloverChecks.
actively, out-of-date stock found in holdings

/EPOSSStockUnit Unexpected error executing Warning ICalled from procedure error handler in
fPostTxnsToLocalSuspense - see audit log for \clsOutlet. fPostTxnsToLocalSuspense.
details.

EPOSSStockUnit I <CurrentApp> I Error in Warning ICalled from clsOutlet.OutstandingSummaries if call
CreateQuery(</ndex>) <ErrMessage> ITALOP_CREATE_QUERY_EX fails.

/EPOSSStockUnit clsOutlet::CAPTrailer - Failed to obtain Warning ICalled from clsOutlet.CAPTrailer if trailer could not be written.
message for Trailer

/EPOSSStockUnit clsOutlet::CashAccountTrailer - Failed to obtain) Warning [Called from clsOutlet.CashAccountTrailer if trailer could not be written.
message for Trailer

/EPOSSStockUnit 'SU:clsRollover.fCreateBTSSuspenseLines() Warning ICalled from clsOutlet.fsCreateBTSSuspenseLines if fsSetBTSTrailers
[ERROR:<ErrNo>:<ErrDescription>) returns a non-empty string.

/EPOSSStockUnit Unexpected error foCheckCap: Warning ICalled from procedure error handler in clsOutlet.foCheckCAP.
<ErrDescription>

EPOSSStockUnit ‘Unexpected error executing Warning ICalled from the procedure error handler in clsOutlet.fSettleLocalSuspense.
fSettleLocalSuspense - see audit log for details.

/EPOSSStockUnit Unexpected error executing fCacheSpotRates - I Warning [Called from the procedure error handler in

see audit log for details.

modDesktopHelpers.fCacheSpotRates. Also called from procedure error
handler in fFreecurrencydata and fsCalculateRate (copy and paste coding
mistake).

©Copyright Fujitsu Services Ltd 2005

COMPANY-in-CONFIDENCE

Page: 75 of 92
FUJITSU

$80 Impact Release 3 EPOSS Counter Operational

R

EP/SPG/001

FUJ00091192
FUJ00091192

Support Guide Version: 1.0
FUNTSU SERVICES COMPANY-In-CONFIDENCE Date: 20/05/2005
Source Application Event Message Type ISupport Notes
EPOSSStockUnit INON INVENTORY PM'S (Recovery) <Index> Info Called from GetNonInventoryPMs in modDesktopHelpers
/EPOSSTxnCorrection Error: Two or more transaction corrections have Error Called from procedure error handler in
the same ID (<CorrectionID>). iclsOutstandingCorrn. foAddedToListOK.
/EPOSSTxnCorrection Unexpected error in Initialize. Error: Error {Called from procedure error handler in clsInterface. Initialize.
[0x<ErrNum>I <ErrDescription>
/EPOSSTxnCorrection Error connecting to OLE Server <ClassName>. Error —_ICalled from clsInterface.foBrokerHandleOK if the class handle could not be
obtained.
/EPOSSTxnCorrection Warning: Isolation could not be determined so I Warning ICalled from clsInterface.fbIsNodelsolated if the command
has been assumed. Problem: CMD_TXN_CORR_ISOLATION_Q sent to EPOSSWatchDog was not
<ErrorDescription> successful.
/EPOSSTxnCorrection ‘Unexpected error executing Warning ICalled from procedure error handler in
fbProcessedCorrectionOK - see audit log for clsCorrectionTxns.fbProcessedCorrectionOK.
details.
IEPOSSTxnCorrection Warning: An attempt was made to invoke a Warning ICalled from clsInterface.Callinterface if m_bAppStarted is False.
public interface before the application has been
initialised.
IEPOSSWatchDog. Unexpected error in Main. Error: Error Called from Initialize in ConnectionWatch class NOT from Main. Used in
[0x<HexErrNo>] <ErrMessage> general procedure error handler.
/EPOSSWatchDog Unable to get connection status to node Error {Called from clsConnectionWatch.CheckNeighboursConnected if a node
<Nodeld>. connection status could not be obtained.
IEPOSSWatchDog. Unexpected error in Timer. Error: Error Called from Timer event of TimerNodeConnected object on form Timers.

[0x<HexErrNo>] <ErrMessage> The node
connection timer has NOT been restarted.

Used in general event error handler.

©Copyright Fujitsu Services Ltd 2005

COMPANY-in-CONFIDENCE

Page: 76 of 92
FUJITSU

$80 Impact Release 3 EPOSS Counter Operational

Ref: EP/SPG/001

FUJ00091192
FUJ00091192

Support Guide Version: 1.0

FUIITSU SERVICES COMPANY-In-CONFIDENCE Date: 20/05/2005

Source Application Event Message Type ISupport Notes

EPOSSWatchDog. Unexpected error in Timer. Error: Error ICalled from Timer event of TimerServerConnected object on form Timers.

[0x<HexErrNo>] <ErrMessage> The server Used in general event error handler.
connection timer has NOT been restarted.

/EPOSSWatchDog Failed to initialise the message object Warning ICalled from Initialize in ConnectionWatch class. Happens when an attempt
to get a EPOSSMessage.clsForDesktop object handle does not return a
successful result.

EPOSSWatchDog Unexpected error executing command Warning ICalled from modDesktopHelpers.fLogErrorinEveniLogliNecessary if

<Message> - details have already been logged mbLogErrorInEventLog is True.
in the audit file
C:Memp\AUDIT_<DayO/Week> LOG

IEPOSSWatchDog Class initialisation completed Info Called from Initialize in ConnectionWatch class.

IEPOSSWatchDog, ‘Node and server watch timers NOT started due Info ICalled from ProcessLogon in ConnectionWatch class. Happens if there's no

to missing definition. persistent object called NodeWatch

IEPOSS WatchDog. Errors reported earlier from Info ICalled from clsConnectionWatch.fUpdateL ANorN WBStatus to report an

fUpdateLANorNWBSiatus have now cleared error cleared.
after <count> cycles reporting failure.
ReportProcessor ‘Could not get Config Info for Cash Account ID Error — ICalled from sub GetUniqueID in modDesktopHelpers in STOCKUNIT
- <CurrentDate&Time> (NOT actually from ReportProcessor), also from GetUniqueld_ErrHandle in
imodDesktopHelpers in ReportProcessor. Caused when 3rd attempt to get
Config Info fails.

ReportProcessor GlobalObjects.dat is Missing or Corrupt Error [Called from CheckGOVersion in forDesktop class. Happens when the string
length of the "Data. Version" attribute value is less than 6 characters.

ReportProcessor Failed to get the current Office CAP used in Error _ ICalled from clsReport.PrepareReport_ErrHandle if the current office cap is

Office Balancing

“or,

©Copyright Fujitsu Services Ltd 2005

COMPANY-in-CONFIDENCE

Page: 77 of 92
FUJITSU

FUJITSU SERVICES

FUJ00091192

FUJ00091192

S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001

Support Guide

COMPANY-In-CONFIDENCE

Version: 1.0
Date: 20/05/2005

5.2 Audit Log

The audit log contains a variety of information — some useful for fault diagnosis and some just debug “noise”.

The audit log is found in folder c:\temp with the name AUDIT_ddd.LOG where ddd is the day of the week in question.

The following information is most likely to be useful for fault diagnosis (concentrating on areas changed). A detailed understanding of the audit
messages requires reference to the code.

Component I Information When logged Example lines
All Component name I On component load. EPOSSReport (EPOSSReportBroker) Version 43.2.1241 [WP21843 Build Thu Mar 31 14:28:37
and version. 2005(GMT)]
Various System error On system error. Also written as I 14:22:45 SystemError: Application=BESReporis.clsB TSReport. (Read ineConfigTable, Code=VB6,
information (see System Error messages to the Text=Err Description - Overflow
section 5.3). message store.
Various Error reporting On error (which may not be A wide variety of error messages are output when an error is detected. Most (but not all) include the
reported to the user or logged by work “error” (search case independently), and if the error was a VB error, most occurrences output
any other means) the VB error number and description. E.g.
BR: ERROR (6) Overflow occurred in clsBESReports.PrintSalesReport
BR: ERROR (9) Subscript out of range occurred in clsBESReports. PrintOfficeSnapshot
BR::Error in clsBESReports. PrintMailsLabel [6 - Overflow]
BR: ERROR (9) Subscript out of rnage occurred in clsBESReports. fProcessTxfrReports
BR-utilsBES.SetCutOffMarker [ERROR: Unable to set a Cut-Off marker for ReportID 123]
BESReports Branch Trading On preview or print of trial or final I Starting report: Branch Trading Statement - Office Copy, bTrial=True
Statement BTS

©Copyright Fujitsu Services Ltd 2005

COMPANY-in-CONFIDENCE Page: 78 of 92
FUJITSU

FUJITSU SERVICES

S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001

Support Guide
COMPANY-In-CONFIDENCE

Version: 1.0
Date: 20/05/2005

FUJ00091192
FUJ00091192

diagnostic
information.

SU INI found CF Line:LineCC, Value:0
SU INI read 9 product holding txns, 9 vs

9 new products
Sorting 28 volume product stock holdings across all SUs
Finishing: 3 pages

BR: Report (Branch Trading Statement - Office Copy) took 2.687

BESReports

Suspense Account

On preview or print of the Suspense

Starting report: Suspense Account - Office Copy

dipnostis, Account report. Processing section: SectionB
Printing section info: ITotalNumTxns=0, dBalanceBF=7
Suppressing empty section
Updating SuspenseBF flag to True
Finishing: 2 pages
Finished successfully
BR: Report (Suspense Account - Office Copy) took 2.213
BESReports BESReports On preview or print of all BR: Report (Office Snapshot) took 2.474
vtemance, I Poms TePOnS BR: Report (Miscellaneous Transactions) took 1.682
BR: Report (BTS Reprint) took 3.214
BR: Report (Sales Report - Office Copy) took 4.276
BESReports Outstanding / On preview or print of the Starting report: Outstanding Transaction Corrections - Office Copy
Processed Outstanding / Processed

Transaction
Correction reports

Transaction Correction reports.

Stored 10 Requested Txn Corr
Finishing: 2 pages

Finished successfully

©Copyright Fujitsu Services Ltd 2005

COMPANY-in-CONFIDENCE Page: 79 of 92
FUJ00091192
FUJ00091192

FUJITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUNTSU SERVICES COMPANY-In-CONFIDENCE Date: 20/05/2005
DataServer Diagnostics On Preview or Print of DataServer / I DS:: clsInternalSession.CompletePopulateTree: Report [Trial Balance - Office Copy] the executed
(mostly GlobalObjects report. query took 1.272 seconds.
Performance DS:: clsInternalSession.CompletePopulateTree: Report [Final Balance - Office Copy] the executed
related)
query took 1.823 seconds.
DS:: clsInternalSession.CompletePopulateTree: Report [Balance Snapshot] the executed query
returned [13] records.
MiMAN Diagnostics On trapping an unexpected VB MI:{class}. {function-name} ERROR: f{err-num}: {err-description} I
code error
MiMAN Diagnostics When there is no CAWeeks entry MI: clsOfficeStatus. fInvalidCalendar: No CAWeek for Final CAP
that corresponds to the
FINAL_CAP pointed to by the
AppConfig data / enabling product
MiMAN Diagnostics Having established that MiMAN MI: clsOfficeStatus.fInvalidCalendar: foCalculateCAP: No data for CAP yyyyce
should be migrating into a CAP, the
CAWeek data for that CAP could
not be found
MiMAN Diagnostics Having established that MiMAN ME clsOfficeStatus. fInvalidCalendar: foCalculateTP - No AccountingPeriods for year yyyy
should be migrating into a TP, the MI: clsOfficeStatus. flnvalidCalendar: fiNextTP - No AccountingPeriods for year yyy
AccountingPeriods data for that TP
year could not be found
MiMAN Diagnostics The AccountingPeriods calendar MI: clsOfficeStatus.fInvalidCalendar: foCalculateTP - No matching Accounting Period for date

does not have an entry which
covers the date in question

dd/mm/yyyy

©Copyright Fujitsu Services Ltd 2005

COMPANY-in-CONFIDENCE

Page: 80 of 92
FUJ00091192

FUJ00091192

FUJITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0

FUNITSU SERVICES COMPANY-In-CONFIDENCE Date: 20/05/2005
5.3 System Error Catalogue
The following system errors can be produced from EPOSS components (for an explanation of system errors see [EP/MAN/001] section 8.2.3):
Error I Component I Code Literal Meaning
Code
00001 I LFSConfimm T ‘The sack was not locked prior to accessing it
00002 LFSConfirm 2 Failed to create Reversal Transaction.
00003 I LFSConfirm 3 Failed to create In Transit Transaction.
00099 I TFSConfirm 9 Unrecognised error state.
01001 BESReports ERR_VBERROR Unexpected Visual Basic run-time error.

EPOSSCote

EPOSSSettlement

LFSConfirm

OBCS
01002 I BESReports ERR_RIPOSTE Unexpected Riposte error (e.g, on return from Retail Broker Transaction TALOP_GET_ ENTRY,

TALOP_CREATE_QUERY, TALOP_QUERY_STATUS)
01002 I EPOSSCore ERR_NOREFDATAMODEPARAMETER I No mode parameter is available for the mode.
01003 I BESReports ERR_BTSMISSINGLINEVALUE Tine value in clsBTSStockUnit.peolL ineValues or clsBTSSuspense.pcolSuspenseValues not found.
01003 I EPOSSCore ERR_NULEMODE
01004 I EPOSSCore ERR_UNKNOWN_VOLSVALUE The ModeParameters object quoted has a VolSValue which is not one of Sale, Loss or Zero which are the only
recognised values used when transacting volume stock.

01005 BESReports ERR_BTSUNKNOWNOPERATOR Unknown node operator value.
01005 EPOSSCore ERR_NO_CURRENT_CONTAINER, No current stock unit is defined when it should be.

©Copyright Fujitsu Servi

es Ltd 2005 COMPANY-in-CONFIDENCE Page: 81 of 92
FUJ00091192

FUJ00091192

FUJITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0

FUUITSU SERVICES COMPANY-In-CONFIDENCE Date: 20/05/2005

01006 BESReports ERR_BTSUNKNOWNNODETYPE Unknown node type.

01006 I EPOSSCore ERR_NO_ORIGINAT_ MODE When dealing with an existing reversal transaction it has proved impossible to lind the existing mode.

01006 EPOSSSettlement I ERR_MI ING_PERSISTENT_OBJECT Persistent object not found

01007 BESReports ERR_BTSUNKNOWNPRINTMETHOD. Unknown print method.

01009 BESReports ERR_BTSMISSINGCAPROLLOVERTRA I SU CAP Rollover Trailer not specified in StockUnit object, or cannot be read.

ILER

Ott I BESReporis ERR _BTSMISSINGOPENINGFIGURES I OpeningFigures trailer message id not present in CAP Rollover Trailer, or OpeningFigures trailer cannot be read, or
OpeningFigures id not present in OpeningFigures trailer.

O1012 I BESReporis ERR _BTSMISSINGBTSBFFIGURES BIBEFigures Trailer message id is not present in the CAP rollover trailer, or the BTSBF Figures Trailer message
cannot be read, or the BTSBFFigures Id is not present in the BTSBFFigures Trailer.

01013 BESReports ERR_BTSMISSINGBTSCFFIGURES BTCFFigures Trailer mes: id is not present in the CAP rollov uiler, or the BTSCFFigures Trailer message
cannot be read, or the BTSCFFigures Id is not present in the BISCFFigures Trailer

01014 BESReports. ERR_B SSINGPREVCAPROLLOVE I PreviousCAPRolloverTrailer message id is not present in the CAP rollover trailer, or cannot be read (a possible reason

RTRAL is Riposte archiving unexpectedly deleted old messages).

O1016 I BESReports ERR_BTSINVALIDTXN Tnvalid stock unit opening figure stock holding txn read, or invalid BTS opening figure Tine txn read.

08001 OBCS. ERR_VBERROR Unexpected Visual Basic run-time error.

08002 I OBCS ERR_NOREFDATA Frror reading persistent object

08003 I OBCS ERR_ADMINWRITE Unable to write Admin message.

©Copyright Fujitsu Services Ltd 2005

COMPANY-in-CONFIDENCE

Page: 82 of 92
FUJ00091192

FUJ00091192
FUNITSU $80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-In-CONFIDENCE Date: 20/05/2005

6.0 Support Route
The support route is the PEAK stack QFP.

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 83 of 92
FU.
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-In-CONFIDENCE Date: 20/05/2005

7.0 Appendix — Explaining the BTS

This Appendix is the contents of an informal document authored by Phil Hemingway. This
pre-dates BTS CP 4002, which caused the following changes regarding cash in pouches:

e “Gains to/from Suspense”. Does not include any cash in pouches transactions.
e “Losses to/from Suspense”. Does not include any cash in pouches transactions.

e “Cash Rems from SUs” renamed from “Cash Rems Moved to Suspense”. Reports cash
put in to pouches transactions (product 5610) as a suspense figure.

« “Cash Rems to Suspense”. New line, with the same value as “Cash Rems from SUs” but
is reported per stock unit rather than as a suspense figure.

* “Cash Pouches Despatched via SUs” renamed from “Cash Collected from Branch”.
Reports cash in pouches dispatched transactions (product 6509) as a suspense figure.

e “Cash Pouches Despatched”. New line, with the same value as “Cash Pouches
Despatched via SUs” but is reported per stock unit rather than as a suspense figure.

INTRODUCTION

This document attempts to provide a presentation of how the Branch Trading Statement (BTS) can be
interpreted, in the absence of the more familiar Cash Account.

Itis not the intention to provide an explanation of every formatted field, rather the principle business content.

From the outset similarities can be drawn between the (wo reports, Firstly they are both Accounting Period End
Reports for the Office, though the accounting period has changed from being a one week trading period to a four
or five week period, Both reports show the period end branch accounting position as a liability the branch has to
POL.

Notwithstanding the difference in format, the main difference between the two reports is that whilst the cash
account reports analysed figures of individual transactions and balances by product, sub-totalling them, the BTS
only shows summary sub-totals.

As an example of the latter, Table 9 on the cash account reports details of all MOP remittances out, and the
subtotal is provided on line 1082 of the cash account, whereas the BTS only reports a sub-total, analogous to if
not exactly the content of line 1082 as would have been.

Other differences between the two reports are that the BTS does not report non-accounting data transactions
such as those that form entries in table 10g or Parcel Traffic.

In other words the primary purpose of the BTS is to report a liability position and a stock position. In this sense
the BTS can be viewed as two separate ‘sections’, the first reporting a financial movement position and the
second the volume stock position.

In interpreting the BTS it is necessary to understand the change at S80 that limits the concept of value stock to
just a few items. All other stock is now controlled by volume and reported in quantities held. This change does
not alter the fact however that the branch has a liability to POL at the end of each Trading Period, for those
items that are classified as value stock.

Hence the two sections of the BTS can be viewed as the first reporting financial liability, and the second volume
stock position. This document focuses on the first section of the report.

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 84 of 92

FUJ00091192
IJ00091192
FUJ00091192
FUJ00091192

FUNITSU $80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-In-CONFIDENCE Date: 20/05/2005

EXAMPLE BTS
An example BTS is provided as follows:

fesppuaed fay sneae tage 4

TeSa Branch Teasing Scatanent ~ UeELce Copy Frew 25/10/2005 To
Branch Total Suspense sa mm ey su
Samm on and 2 Fe erred a8e0.90 9800.65
Gash Avaiting Cortectson ® Fd
Suspense B Fed
eher 2 2 Fed 2 30.92 2.c0 586.70 9.90
Poekx B Bw 1298.98 Beas Sco slpee. 33 2190
Bexieeances 009.09 6.00 4009.00 coe 2.00
Bains vo/trou Suspense aa 9s. 56.00 9.08 9.06 9.90
Exanetare In tron senor Se ta Sho elbe 8105
brie heceiper 697.08 3c eae be
Renietances Os Tonal 6.20 2.00 0.06 9.00
Jed. from Branch 2.08
deiner Daguanes aoe ae 30186
cam on Hand © Ped 1854, 08 9070.65
Ear Suatting Coleccion © Tod ag.ve
Sssiee
erv.ue 9.90
445.066- 327086
2.09 6.00 2.90
39.00 30.90 2.60 9.90
6.90 one
aoe Bie 3.60 ene eolhe
3.00 ble a.eo e186
Toval Branch adjustments 39.00 5.00 9.00 c.00 30.00

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 85 of 92
FUJITSU

FUJITSU SERVICES

S80 Impact Release 3 EPOSS Counter Operational
Support Guide

COMPANY-In-CONFIDENCE

PRESENTATION VIEW

The view of the BTS to be adopted by this document sees the first section of the report as six distinct groupings

of information:

Presentation Group

BTS Lines (denoted by row headings)

Brought Forward Figures

Cash on Hand B Fwd

Cash Awaiting Collection B Fwd.
Other MOP B Fwd

ForEx B Fwd

Other Postage B Fwd

Receipts Movements.

Remittances In Total

Cash Rems Moved to Suspense
Gains to/from Suspense
Transfers In from other SUs

Other Receipts

Payments Movements

Remittances Out Total

Cash Collected from Branch
Losses to/from Suspense
Transfers Out to other SUs

Other Payments

Carried Forward Position

Cash on Hand C Fwd

Cash Awaiting Collection C Fwd.
Other MOP C Fwd.

ForEx C Fwd

Other Postage C Fwd

Total C Fwd

Trading Position

Trading Position (+/-)

‘Adjustments

Discrepancy OVER Transferred
Discrepancy SHORT Transferred
Discrepancy OVER Resolved
Discrepancy SHORT Resolved
Excess Cash Removed

Cash Shortage Made Good

Total Branch Adjustments

©Copyright Fujitsu Services Ltd 2005

COMPANY-in-CONFIDENCE

FUJ00091192
FUJ00091192

Ref:
Version:
Date:

Page: 86 of 92
FU.
FUNITSU $80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-In-CONFIDENCE Date: 20/05/2005

The cash account view will be used as the primary source for comparison, and the balance report secondly.
DESIGN VIEW
It's perhaps worth a paragraph to provide an overview of the BTS in design terms.

The design of the BTS utilises the fact that most of the raw data content is already available to EPOSS at the
time the Office balance report, in the form of the Accounting Node Hierarchy Dataserver memory tree. This
provides all the raw data in the form of node accumulations in memory, largely without change to the existing
system.

By specifying the BTS in terms of a set of data sources to be printed reference data can be used to define the
BTS in terms of a sourcing and formatting structure. Hence the reference data can instruct data to write out the
requisite source values and the report function can similarly use the same data to be instructed to report the
source data in certain positions.

The only problem is that dataserver has the data of balances and movements for the current accounting period,
and has not got the brought forward position. In other words it has the carried forward position. This is resolved
by identifying an accounting period item within reference data for dataserver to forward write items for the
following BTS.

Hence the BTS figures in design terms are seen as a set of node accumulations. Extensions are provided
allowing nodes to be combined though simple equations, and exception node and product accumulations
included or excluded.

It is for this reason that the specification of the BTS in the HLD is provided as a set of source data node
derivations.

BROUGHT FORWARD FIGURES VIEW,

The brought forward figures view on the BTS should be the same as the carried forward figures view from the
previous BTS in all except obviously the very first BTS.

Itis the intention of this section to explain the derivation of the first set of figures from the final cash account
only.

The first set of brought forward figures represent the branch liability to POL AFTER the final office CAP
rollover, the majority of the old value stock holdings now being removed from that liability.

Let's take an example:

Last Cash Account First BTS

Brought Forward Figures

Table 2 (Page I Suspense B Fwd -£38, the total gains are offset

: —— against total losses, excluding cash in pouches. A
Line 5031 Shortages in REMS etc £40 gain is reflected as a negative as it reduces the

Line 5037 Cash Awaiting Collection £66 liability the branch has to POL, a loss as a

positive figure increases the liability
Table 3 (Page I

Cash Awaiting Collection B Fwd £66
Line 5063 Pre-purchase £78

Table 5 (Page 2

Line 2050 Cash £1000 Cash on Hand B Fwd £1000
Line 2051 Cheques £500 Other MOP B Fwd £500
Line 2052 Fgn Curr Sterl Equiv £125 ForEx B Fwd £125

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 87 of 92

FUJ00091192
IJ00091192
FUJITSU

FUJITSU SERVICES

COMPANY-!

FUJ00091192

FUJ00091192
S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
In-CONFIDENCE Date: 20/05/2005

Line 2053 Game Licences £60 (let's say office has
10 game red at £5 each)

No contribution to Brought Forward Figures.
There will however be an entry in the Stock
Section for Game Red indicating a quantity of 10

Line 2057 Postage Stamps £302 from Table 5b

Table Sb (Page 4)

Line 5011 Ist Class Stps £280 (Let's say office
has 1000 Ist class at 0.28p each)

No contribution to Brought Forward Figures.
There will however be an entry in the Stock
Section for Ist class stamps indicating a quantity
of 1000

Line 5090 Other Postage Items £22

Other Postage B Fwd £22

The entries of game licences and Ist class stamps on the final cash account will not contribute to the brought
forward figures on the first BTS because they are no longer designated as value stock and are now volume

stock.

If nothing else happened in the opening trading period the same figures would be reflected in the carried
forward group of the BTS. Hence there would be a total carried forward of £1675. This is exactly the same as
the total in Table 5 of the final cash account, and is the balance due to PO on line 1085, using the following
equation. Entries in Table 5(£1000, £500, £125, £22) = £1647, plus unclaimed payments, Table 2 (£106), gives
Sub Total £1753, less Uncharged Receipts, Table 3 (£78), gives Table 5 Total £1675. Note the items for Game
Red and Ist class stamps now volume stock are excluded for reconciliation purposes. It is hence possible to

abstract:

¢ Cash on Hand B Fwd is equivalent to line 2050 on the last cash account

e — Cash Awaiting Collection B Fwd is equivalent to line 5037 on the last cash account

¢ Other MOP B Fwd is equivalent to line 2051 on the last cash account

e  ForEx B Fwd is equivalent to line 2052 on the last cash account

© Other Postage B Fwd is equivalent to line 5090 on the last cash account

¢ Suspense B Fwd is equivalent to the sum of tables 2 and 2a, less line 5037, minus the sum of table 3

A variation from this abstraction is likely explained by products no longer mapping to these lines or becoming

volume stock.

©Copyright Fujitsu Services Ltd 2005

COMPANY-in-CONFIDENCE

Page: 88 of 92
FUJITSU

FUJITSU SERVICES

S80 Impact Release 3 EPOSS Counter Operational
Support Guide

COMPANY-In-CONFIDENCE

FUJ00091192

FUJ00091192
Ref: EP/SPG/001
Version: 1.0
Date: 20/05/2005

RECEIPTS MOVEMENTS VIEW

The receipts movements view on the BTS represents the total of movements within the current trading period
that either increase the liability of the branch to POL or move some of that liability between stock units and/or
suspense. It has some equivalence to what would have been represented on the cash account, but as a

comparison the cash account is not as useful.

It is the intention of this section to explain the derivation of these figures.

Let's take an example:

Action/Notional Cash Account Effect

BTS

Receipt Movement Figures

Table 6 (Page 4

Remittances In Total £4378

Line 6014 Cash £2000

The sum of the value stock remittances in will be

Line 6015 Cheques £2300

represented in the Branch Total, whilst the stock
unit figures will represent whatever part of the

Table 6a (Page 4

total each SU remitted in

Line 6150 Other Postage Items £78

Line 6109 2nd Class Stps £40 (let's say SU remits
in 200 to sell at 0.20p each)

No contribution to Receipt Movements. There
will however be an entry in the Stock Section for
2nd class stamps indicating a quantity of 200

Table 2 (Page 1

Line 5037 Cash In Pouches £4000

Cash Rems Moved to Suspense £4000

A remittance out to the is value will be reflected
in the Payments Movements group, which nets the
trading position to zero

Table 3 (Page 1

Line 5060 Pre-purchase £230 (Let's say SUA)

Gains to/from Suspense SUA £230

Line 5065 Surplus in Rems £420 (Let's say SUB)

Gains to/from Suspense SUB £420

Line 5046 Cash Shortages A £115

Gains to/from Suspense (Susp) -£115

The suspense column is derived as the sum total
of all loss suspense movements for each stock
unit, in the payments movements group

Gains to/from Suspense (Branch) £535

The signs reflect the line descriptions hence the
gains take precedence

Transfer In from other SUs

There is no equivalence of a transfer to the cash
account; as all transfers in and out must have been
completed before SU rollover the net movement
for the office is nil. Let's say SU A transfers cash
£5100 and game blue quantity 10 to SU B within
the trading period

Transfers In from SUs (SU B and Branch Total)
£5100

There will be no contribution of the game blue
transfer to Receipts Movements nor to the Stock
Total as the net stock movement is zero.
Reconciliation of transfers in_must be performed

©Copyright Fujitsu Services Ltd 2005

COMPANY-in-CONFIDENCE

Page: 89 of 92
FUJ00091192

FUJ00091192
ea $80 Im + Operati Ref: EP/SPG/001
pact Release 3 EPOSS Counter Operational ‘
FUJITSU Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-In-CONFIDENCE Date: 20/05/2005

Action/Notional Cash Account Effect

BTS

against the office and SU balance reports

Other Receipts

There is only a partial equivalence between Other
Receipts and the receipts table on the cash
account. On the cash account the receipts table
reflects all receipts whereas on the BTS it is the
entire receipts movement group that reflects entire
receipts. Hence other receipts reflects everything
but the other line entries of the group, that
increases the branch liability (ie the increases the
branch value)

So Remittances in, transfers in, cash in pouches
and suspense items are excluded.

Included are local suspense receipt items, sale of
non-value stock, sale of non-stock items, also the
branch balance forward figure from the previous
accounting period

EXAMPLE TO BE PROVIDED

PAYMENTS MOVEMENTS VIEW,

The payments movements view on the BTS represents the total of movements within the current trading period
that either reduce the liability of the branch to POL or move some of that liability between stock units and/or
suspense. It has some equivalence to what would have been represented on the cash account, but as a

comparison the cash account is not that useful.

Itis the intention of this section to explain the derivation of these figures.

Let's take an example:

Action/Notional Cash Account Effect

BTS

Receipt Movement Figures

Table 6 (Page 4)

Remittances In Total £4378

Line 6014 Cash £2000

The sum of the value stock remittances in will be

Line 6015 Cheques £2300

represented in the Branch Total, whilst the stock
unit figures will represent whatever part of the

Table 6a (Page 4

total each SU remitted in

Line 6150 Other Postage Items £78

Line 6109 2nd Class Stps £40 (let's say SU remits
in 200 to sell at 0.20p each)

No contribution to Receipt Movements. There
will however be an entry in the Stock Section for
2nd class stamps indicating a quantity of 200

Table 2 (Page 1

Line 5037 Cash In Pouches £4000

Cash Rems Moved to Suspense £4000

A remittance out to the is value will be reflected
in the Payments Movements group, which nets the

©Copyright Fujitsu Services Ltd 2005

COMPANY-in-CONFIDENCE

Page: 90 of 92
FU.
FUNITSU $80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-In-CONFIDENCE Date: 20/05/2005
Action/Notional Cash Account Effect BTS

trading position to zero

Table 3 (Page I

Line 5060 Pre-purchase £230 Gains to/from Suspense (Susp) -£650

Line 5065 Surplus in Rems £420

Line 5046 Cash Shortages A £115 (Let's say I Gains to/from Suspense (SUC) £115
SUC)

Gains to/from Suspense (Branch) -£535

The signs reflect the line descriptions hence the
gains take precedence

Transfer Out to other SUs

There is no equivalence of a transfer to the cash I Transfers Out from SUs (SU A and Branch Total)
account; as all transfers in and out must have been I £5100

completed before SU rollover the net movement
for the office is nil. Let's say SU A transfers cash
£5100 and game blue quantity 10 to SU B within
the trading period

There will be no contribution of the game blue
transfer to Payments Movements nor to the Stock
Total as the net stock movement is zero.
Reconciliation of transfers in must be performed
against the office and SU balance reports

Other Payments

There is only a partial equivalence between Other
Payments and the payments table on the cash
account. On the cash account the payments table
reflects all payments whereas on the BTS it is the
entire payments movement group that reflects
entire payments. Hence other payments reflects
everything but the other line entries of the group,
that reduces the branch liability (ie the reduces the
branch value)

So Remittances out, transfers out, cash in transit
and suspense items are excluded.

Included are local suspense payment items, and
payment items such as cash withdrawal.

EXAMPLE TO BE PROVIDED

CARRIED FORWARD FIGURES VIEW

The carried forward figures view on the BTS establishes a new branch liability position taking into account the
brought forward liability position, together with movements within the trading period that increase the liability
and movements that decrease the liability.

The figures are derived by the simply accumulation of corresponding lines in the previous 3 groups and
examining the current value stock position.

So:

e Cash on Hand C Fwd is the revised Cash position at the end of the trading period.

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 91 of 92

FUJ00091192
IJ00091192
FUJ00091192

FUJ00091192
FUNITSU S80 Impact Release 3 EPOSS Counter Operational Ref: EP/SPG/001
Support Guide Version: 1.0
FUUITSU SERVICES COMPANY-In-CONFIDENCE Date: 20/05/2005

e Cash Awaiting collection C Fwd adds any additional amount of cash awaiting collection in addition to
the brought forward figure, and reduces it by any amount now in transit.

© Suspense C Fwd adds any loss during the period to the brought forward net suspense balance and
reduces it by any gains during the trading period

e Other MOP C Fwd is the revised Other MOP stock figure at the end of the trading period.
«  ForEx C Fwd is the revised ForEx stock figure at the end of the trading period.
© Other Postage C Fwd is the revised Other Postage stock figure at the end of the trading period.

¢ Total C Fwd is the sum of all liabilities above.

©Copyright Fujitsu Services Ltd 2005 COMPANY-in-CONFIDENCE Page: 92 of 92
